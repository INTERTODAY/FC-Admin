"use strict";window.define(["common"],function(o){function t(o){n=this,n.extendOptions(o),n.init()}var n,e,a=a||window.$,i=i||window.axios,l=new window.XMLHttpRequest,d=a(".fileuploader-bar"),r=a(".fileuploader-percent"),p=a("#status"),c="0%";return t.prototype={options:{},extend:function(o,t){for(var n in t)t.hasOwnProperty(n)&&(o[n]=t[n]);return o},extendOptions:function(o){this.options=this.extend({},this.options),this.extend(this.options,o)},init:function(){a("#cancel-button").attr("disabled",!0),a("#upload-button").on("click",function(){if(!n.validate())return!1;a("#upload-button").attr("disabled",!0),a("#cancel-button").attr("disabled",!1),n.getUploadInfo()}),a("#cancel-button").on("click",function(o){l.abort(),n.cancelUpload()})},getUploadInfo:function(){i.get("/api/v1/fineuploader/token").then(function(o){var t=o.data.uploadInfo;t&&(n.options.uploadUrl=t.uploadUrl.replace("v4","cdnovp"),n.options.uploadCancelUrl=t.uploadCancelUrl,n.options.token=t.token,n.send())})},clearForm:function(){a("#upload-button").attr("disabled",!1),a("#cancel-button").attr("disabled",!0),a("#fileupload").val(""),c="0%",d.width(c),r.html(c)},cancelUpload:function(){i.post(n.options.uploadCancelUrl+"?token="+n.options.token,{token:n.options.token}).then(function(o){window.alert("업로드 취소"),n.clearForm()}).catch(function(o){console.log(o)})},validate:function(){return 0!==a("#fileupload").get(0).files.length||(window.alert("파일을 선택하세요."),!1)},send:function(){var t=new window.FormData,i=a("#fileupload").get(0).files[0];e=o.makeid()+"."+o.getExtension(i.name),t.append("token",n.options.token),t.append("folder",2004661),t.append("pkg",1006241),t.append("target_path",n.options.uploadFolder),t.append("videofile",i,e),a.ajax({url:n.options.uploadUrl+"?token="+n.options.token,data:t,type:"post",contentType:!1,processData:!1,cache:!1,beforeSend:function(){p.empty(),c="0%",d.width(c),r.html(c)},xhr:function(){return l.upload&&l.upload.addEventListener("progress",function(o){o.lengthComputable&&(c=Math.floor(o.loaded/o.total*100)+"%",d.width(c),r.html(c))},!1),l},success:function(o){var t=JSON.parse(o);console.log(t),"None"===t.uploadInfo.errorInfo.errorCode?(c="100%",d.width(c),r.html(c),window.alert("업로드 성공"),n.clearForm(),a("#aqua-video-code").val("onm_"+e),a("#fineUploader").modal("hide"),n.options.callback({success:!0,videoName:e})):window.alert(t.uploadInfo.errorInfo.errorMessage),a("#upload-button").attr("disabled",!1),a("#cancel-button").attr("disabled",!0)}})},send2:function(){}},t});
//# sourceMappingURL=../../maps/components/jquery_form_uploader_service.js.map
