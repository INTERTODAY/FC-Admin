"use strict";window.define(["common"],function(o){function t(o){n=this,n.extendOptions(o),n.init()}var n,e,a=a||window.$,i=i||window.axios,d=new window.XMLHttpRequest,l=a(".fileuploader-bar"),p=a(".fileuploader-percent"),r=a("#status"),c="0%";return t.prototype={options:{},extend:function(o,t){for(var n in t)t.hasOwnProperty(n)&&(o[n]=t[n]);return o},extendOptions:function(o){this.options=this.extend({},this.options),this.extend(this.options,o)},init:function(){a("#cancel-button").attr("disabled",!0),a("#upload-button").on("click",function(){if(!n.validate())return!1;a("#upload-button").attr("disabled",!0),a("#cancel-button").attr("disabled",!1),n.getUploadInfo()}),a("#cancel-button").on("click",function(o){d.abort(),n.cancelUpload()})},getUploadInfo:function(){i.get("/api/v1/fineuploader/token").then(function(o){var t=o.data;t&&(n.options.uploadUrl=t.uploadInfo.uploadUrl.replace("v4","cdnovp").replace("http","https"),n.options.uploadCancelUrl=t.uploadInfo.uploadCancelUrl.replace("http","https"),n.options.token=t.uploadInfo.token,n.options.deploy_package_id=t.deploy_package_id,n.options.folder_id=t.folder_id,n.send())})},clearForm:function(){a("#upload-button").attr("disabled",!1),a("#cancel-button").attr("disabled",!0),a("#fileupload").val(""),c="0%",l.width(c),p.html(c)},cancelUpload:function(){i.post(n.options.uploadCancelUrl+"?token="+n.options.token,{token:n.options.token}).then(function(o){window.alert("업로드 취소"),n.clearForm()}).catch(function(o){console.log(o)})},validate:function(){return 0!==a("#fileupload").get(0).files.length||(window.alert("파일을 선택하세요."),!1)},send:function(){var t=new window.FormData,i=a("#fileupload").get(0).files[0];e=o.makeid()+".mp4",t.append("token",n.options.token),t.append("folder",n.options.folder_id),t.append("pkg",n.options.deploy_package_id),t.append("target_path",n.options.uploadFolder),t.append("videofile",i,e),a.ajax({url:n.options.uploadUrl+"?token="+n.options.token,data:t,type:"post",contentType:!1,processData:!1,cache:!1,beforeSend:function(){r.empty(),c="0%",l.width(c),p.html(c)},xhr:function(){return d.upload&&d.upload.addEventListener("progress",function(o){o.lengthComputable&&(c=Math.floor(o.loaded/o.total*100)+"%",l.width(c),p.html(c))},!1),d},success:function(o){var t=JSON.parse(o);"None"===t.uploadInfo.errorInfo.errorCode?(c="100%",l.width(c),p.html(c),window.alert("업로드 성공"),n.clearForm(),a("#aqua-video-code").val("onm_"+e),a("#fineUploader").modal("hide"),n.options.callback({success:!0,videoName:e,pkg:1006241,access_key:t.uploadInfo.uploadDetail.access_key,token:n.options.token})):window.alert(t.uploadInfo.errorInfo.errorMessage),a("#upload-button").attr("disabled",!1),a("#cancel-button").attr("disabled",!0)}})},send2:function(){}},t});
//# sourceMappingURL=../../maps/components/jquery_form_uploader_service.js.map
