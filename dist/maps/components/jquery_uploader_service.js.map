{"version":3,"sources":["components/jquery_uploader_service.js"],"names":["window","define","self","$","axios","JqueryFileUploaderService","options","extend","a","prototype","b","key","hasOwnProperty","extendOptions","getUploadInfo","this","attr","init","uploadUrl","get","setJqueryFileUploader","data","response","uploadInfo","replace","uploadCancelUrl","cancelUpload","token","console","log","error","alert","fileupload","dataType","acceptFileTypes","formData","folder","target_path","replaceFileInput","add","jqXHR","pkg","uploadFolder","responseJSON","e","errorInfo","errorCode","modal","callback","done","progressall","progress","parseInt","errorMessage","val","loaded","total","html","css","each","files","index","file","name","on","bind","errorThrown"],"mappings":"AAAA,YAEAA,QAAOC,QAOL,SACA,QALA,0BAOA,sBACEC,qBALD,SAAUC,EAAGC,GAId,QAASC,GAA2BC,GAOpCD,EAAAA,KAEEC,EAAAA,cAFoCA,GAGpCC,EAAAA,OAPAL,GAAAA,EAsHF,OA5GQM,GAAAC,WAEHH,WACDC,OAAA,SAAAC,EAAAE,GATkC,IAAA,GAAAC,KAAAD,GAWpCA,EAAAE,eAAAD,KACAE,EAAAA,GAAeH,EAAAC,GAZqB,OAAAH,IAkBlCN,cAAKY,SAALR,GACAH,KAAEG,QAAAS,KAAkBC,UAAKD,KAAzBT,SAnBkCS,KAAAR,OAAAQ,KAAAT,QAAAA,IAwBhCW,KAAA,WACAf,EAAAY,gBACEZ,EAAAA,kBAAagB,KAAAA,YAAiBA,IAE9BhB,cAAKI,WANTF,EAAMe,IAAI,8BAQNjB,KAAAA,SAAKkB,GACN,GAAAC,GAAAC,EAAAD,KAAAE,UATHF,KAtBkCnB,EAAAI,QAAAY,UAAAG,EAAAH,UAAAM,QAAA,KAAA,UAkCpCtB,EAAAI,QAAAmB,gBAAAJ,EAAAI,gBACAC,EAAAA,QAAcC,MAAAN,EAAAM,MAEVA,EAAOzB,4BAMRwB,aACM,WACLE,EAAAA,KAAQC,EAAIC,QAAZL,gBAAA,UAAAvB,EAAAI,QAAAqB,OATFA,MAAAzB,EAAAI,QAAAqB,QAYFP,KAAAA,SAAAA,GACEpB,OAAA+B,MAAA,UARE5B,EAAE,kBAAkBa,KAAK,YAAY,GAUrCb,EAAA,kBAAoBa,KAAA,YAAiBV,KAEvCH,MAAE,SAAe6B,GACfC,QAAAA,IAAUH,MAGVI,sBAAiB,WACjBC,GAAAA,EAEEC,GAAAA,eAAQpB,KAFA,WAAAd,EAAAI,QAAAY,UAAA,UAAAhB,EAAAI,QAAAqB,OAIRU,EAAAA,eAAanC,YAJL+B,SALgB,OAW1BK,mBAAkB,EAClBC,YAAK,EACHpC,gBAAE,qBACAA,UACAA,MAAED,EAAAI,QAAFqB,MACAa,OAAAA,QACDC,IAJD,QAbwBJ,YAAAnC,EAAAI,QAAAoC,cAoBxBJ,kBAAIK,EARNJ,IAAK,SAAUK,EAAGvB,GAUhBlB,EAAA,kBAAiBoB,IAAAA,SAAWsB,GAAAA,QAAUC,WACpC9C,EAAAA,kBAAagB,KAAb,YAAA,GACAb,EAAE,kBAAiB4C,KAAM,YAAzB,GACA7C,EAAKI,EAAQ0C,YAGdC,KAAA,SAAAL,EAAAvB,GARD,GAAIsB,GAAetB,EAAKmB,MAAMG,YAW9B,UAAEA,EAAApB,WAAuBsB,UAAYC,WA/Bb9C,OAAA+B,MAAA,UAiC1BmB,EAAAA,iBAAaH,MAAA,QACX7C,EAAIiD,QAAWC,SAAS/B,IAEtBrB,OAAA+B,MAAAY,EAAApB,WAAFsB,UACIQ,cAPJlD,EAAE,kBAAkBa,KAAK,YAAY,GAavCb,EAAA,kBAAoBa,KAAA,YAAiB,IAEnCb,YAAE,SAAFyC,EAAsBU,GADxB,GAAAH,GAAAC,SAAA/B,EAAAkC,OAAAlC,EAAAmC,MAAA,IAAA,GATErD,GAAE,mBAAmBsD,KAAKN,EAAW,KAarChD,EAAA,uCAA8BuD,IAC9BlB,QADFW,EAAA,QAOEjD,EAAAA,eAAKwB,KAAL,gBAAA,SAAAkB,EAAAvB,GACDlB,EAAAwD,KAAAtC,EAAAuC,MAAA,SAAAC,EAAAC,GAHH3D,EAAA,oBAAAmD,IAAA,OAAAQ,EAAAC,QALE5D,EAAE,kBAAkB6D,GAAG,QAAS,SAAUpB,GAazCvC,EAAAA,YARHF,EAAE,eAAe8D,KAAK,iBAAkB,SAAUrB,EAAGvB,GAC1B,UAArBA,EAAK6C,aACPhE,EAAKwB,mBAMNrB","file":"components/jquery_uploader_service.js","sourcesContent":["'use strict';\n\nwindow.define([\n  'jquery',\n  'axios',\n  'jquery.iframe-transport',\n  'jquery-ui/ui/widget',\n  'jquery.fileupload'\n], function ($, axios) {\n  var self;\n  var uploader;\n\n  function JqueryFileUploaderService (options) {\n    self = this;\n\n    self.extendOptions(options);\n    self.init();\n  }\n\n  JqueryFileUploaderService.prototype = {\n    // 옵션 저장 변수\n    options: {},\n    extend: function (a, b) {\n      for (var key in b) {\n        if (b.hasOwnProperty(key)) {\n          a[key] = b[key];\n        }\n      }\n      return a;\n    },\n    // 옵션 확장\n    extendOptions: function (options) {\n      this.options = this.extend({}, this.options);\n      this.extend(this.options, options);\n    },\n    // 컴포넌트 초기화\n    init: function () {\n      self.getUploadInfo();\n      $('#cancel-button').attr('disabled', true);\n    },\n    getUploadInfo: function () {\n      axios.get('/api/v1/fineuploader/token')\n      .then(function (response) {\n        var data = response.data.uploadInfo;\n        if (data) {\n          self.options.uploadUrl = data.uploadUrl.replace('v4', 'cdnovp');\n          self.options.uploadCancelUrl = data.uploadCancelUrl;\n          self.options.token = data.token;\n\n          self.setJqueryFileUploader();\n        }\n      });\n    },\n    // 업로드를 취소한다.\n    cancelUpload: function () {\n      axios.post(self.options.uploadCancelUrl + '?token=' + self.options.token, {\n        token: self.options.token\n      })\n      .then(function (response) {\n        window.alert('업로드 취소');\n        $('#upload-button').attr('disabled', false);\n        $('#cancel-button').attr('disabled', true);\n      })\n      .catch(function (error) {\n        console.log(error);\n      });\n    },\n    setJqueryFileUploader: function () {\n      var jqXHR;\n\n      $('#fileupload').attr('data-url', self.options.uploadUrl + '?token=' + self.options.token);\n\n      $('#fileupload').fileupload({\n        dataType: 'json',\n        singleFileUploads: true,\n        autoUpload: false,\n        acceptFileTypes: /(\\.|\\/)(mp4|avi)$/i,\n        formData: {\n          token: self.options.token,\n          folder: 2004661,\n          pkg: 1006241,\n          target_path: self.options.uploadFolder\n        },\n        replaceFileInput: false,\n        add: function (e, data) {\n          $('#upload-button').off('click').on('click', function () {\n            $('#upload-button').attr('disabled', true);\n            $('#cancel-button').attr('disabled', false);\n            jqXHR = data.submit();\n          });\n        },\n        done: function (e, data) {\n          var responseJSON = data.jqXHR.responseJSON;\n\n          if (responseJSON.uploadInfo.errorInfo.errorCode === 'None') {\n            window.alert('업로드 성공');\n            $('#fineUploader').modal('hide');\n            self.options.callback(data);\n          } else {\n            window.alert(responseJSON.uploadInfo.errorInfo.errorMessage);\n          }\n\n          $('#upload-button').attr('disabled', false);\n          $('#cancel-button').attr('disabled', true);\n        },\n        progressall: function (e, data) {\n          var progress = parseInt(data.loaded / data.total * 100, 10);\n          $('#progress-value').html(progress + '%');\n          $('#progress .jquery-file-progress-bar').css(\n              'width',\n              progress + '%'\n          );\n        }\n      });\n\n      $('#fileupload').bind('fileuploadadd', function (e, data) {\n        $.each(data.files, function (index, file) {\n          $('#aqua-video-code').val('onm_' + file.name);\n        });\n\n        $('#cancel-button').on('click', function (e) {\n          jqXHR.abort();\n        });\n      });\n\n      $('#fileupload').bind('fileuploadfail', function (e, data) {\n        if (data.errorThrown === 'abort') {\n          self.cancelUpload();\n        }\n      });\n    }\n  };\n\n  return JqueryFileUploaderService;\n});\n"],"sourceRoot":"/source/"}