{"version":3,"sources":["components/jquery_uploader_service.js"],"names":["window","define","Util","JqueryFileUploaderService","options","self","this","extendOptions","$","axios","prototype","extend","a","b","key","hasOwnProperty","init","getUploadInfo","attr","then","response","data","uploadInfo","setJqueryFileUploader","uploadUrl","replace","uploadCancelUrl","token","post","cancelUpload","alert","location","reload","catch","formData","error","append","dataType","FormData","singleFileUploads","autoUpload","acceptFileTypes","uploadFolder","fileupload","console","jqXHR","replaceFileInput","add","e","done","off","on","responseJSON","submit","errorInfo","errorCode","modal","progressall","callback","progress","errorMessage","files","parseInt","val","loaded","file","name","html","css","errorThrown","index","abort","bind","log"],"mappings":"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","file":"components/jquery_uploader_service.js","sourcesContent":["'use strict';\n\nwindow.define([\n  'common',\n  'jquery.iframe-transport',\n  'jquery-ui/ui/widget',\n  'jquery.fileupload'\n], function (Util) {\n  var self;\n  var $ = $ || window.$;\n  var axios = axios || window.axios;\n  var jqXHR;\n\n  function JqueryFileUploaderService (options) {\n    self = this;\n\n    self.extendOptions(options);\n    self.init();\n  }\n\n  JqueryFileUploaderService.prototype = {\n    // 옵션 저장 변수\n    options: {},\n    extend: function (a, b) {\n      for (var key in b) {\n        if (b.hasOwnProperty(key)) {\n          a[key] = b[key];\n        }\n      }\n      return a;\n    },\n    // 옵션 확장\n    extendOptions: function (options) {\n      this.options = this.extend({}, this.options);\n      this.extend(this.options, options);\n    },\n    // 컴포넌트 초기화\n    init: function () {\n      self.getUploadInfo();\n      $('#cancel-button').attr('disabled', true);\n    },\n    getUploadInfo: function () {\n      axios.get('/api/v1/fineuploader/token')\n      .then(function (response) {\n        var data = response.data.uploadInfo;\n        if (data) {\n          self.options.uploadUrl = data.uploadUrl.replace('v4', 'cdnovp');\n          self.options.uploadCancelUrl = data.uploadCancelUrl;\n          self.options.token = data.token;\n\n          // console.log(data);\n\n          self.setJqueryFileUploader();\n        }\n      });\n    },\n    // 업로드를 취소한다.\n    cancelUpload: function () {\n      axios.post(self.options.uploadCancelUrl + '?token=' + self.options.token, {\n        token: self.options.token\n      })\n      .then(function (response) {\n        window.alert('업로드 취소');\n        window.location.reload();\n        // $('#upload-button').attr('disabled', false);\n        // $('#cancel-button').attr('disabled', true);\n\n        // $('#fileupload').fileupload('destroy');\n        // $('#fileupload').val('');\n\n        // self.getUploadInfo();\n      })\n      .catch(function (error) {\n        console.log(error);\n      });\n    },\n    setJqueryFileUploader: function () {\n      // console.log(self.options);\n      $('#fileupload').attr('data-url', self.options.uploadUrl + '?token=' + self.options.token);\n\n      var formData = new window.FormData();\n      formData.append('token', self.options.token);\n      formData.append('folder', 2004661);\n      formData.append('pkg', 1006241);\n      formData.append('target_path', self.options.uploadFolder);\n      // formData.append('videofile', $('#fileupload').get(0).files[0], '123.mp4');\n\n      $('#fileupload').fileupload({\n        dataType: 'json',\n        singleFileUploads: true,\n        autoUpload: false,\n        acceptFileTypes: /(\\.|\\/)(mp4|avi)$/i,\n        formData: formData,\n        replaceFileInput: false,\n        add: function (e, data) {\n          $('#upload-button').off('click').on('click', function () {\n            $('#upload-button').attr('disabled', true);\n            $('#cancel-button').attr('disabled', false);\n\n            console.log(data);\n            jqXHR = data.submit();\n          });\n        },\n        done: function (e, data) {\n          var responseJSON = data.jqXHR.responseJSON;\n\n          if (responseJSON.uploadInfo.errorInfo.errorCode === 'None') {\n            window.alert('업로드 성공');\n            $('#fineUploader').modal('hide');\n            self.options.callback(data);\n          } else {\n            window.alert(responseJSON.uploadInfo.errorInfo.errorMessage);\n          }\n\n          $('#upload-button').attr('disabled', false);\n          $('#cancel-button').attr('disabled', true);\n        },\n        progressall: function (e, data) {\n          var progress = parseInt(data.loaded / data.total * 100, 10);\n          $('#progress-value').html(progress + '%');\n          $('#progress .jquery-file-progress-bar').css(\n              'width',\n              progress + '%'\n          );\n        }\n      });\n\n      $('#fileupload').bind('fileuploadadd', function (e, data) {\n        $.each(data.files, function (index, file) {\n          $('#aqua-video-code').val('onm_' + file.name);\n        });\n\n        $('#cancel-button').on('click', function (e) {\n          jqXHR.abort();\n        });\n      });\n\n      $('#fileupload').bind('fileuploadfail', function (e, data) {\n        if (data.errorThrown === 'abort') {\n          self.cancelUpload();\n        }\n      });\n\n      $('#fileupload').bind('fileuploadsubmit', function (e, data) {\n        // var formData = [\n        //   { name: 'token', value: self.options.token },\n        //   { name: 'folder', value: 2004661 },\n        //   { name: 'pkg', value: 1006241 },\n        //   { name: 'target_path', value: self.options.uploadFolder },\n        //   { name: 'videofile', value: $('#fileupload').get(0).files[0], filename: '123.mp4' }\n        // ];\n\n        // data.formData = formData;\n        console.log(data.formData);\n        // data.formData.set('videofile', $('#fileupload').get(0).files[0], '123.mp4');\n      });\n    }\n  };\n\n  return JqueryFileUploaderService;\n});\n"],"sourceRoot":"/source/"}