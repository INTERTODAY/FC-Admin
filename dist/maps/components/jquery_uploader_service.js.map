{"version":3,"sources":["components/jquery_uploader_service.js"],"names":["window","define","Util","JqueryFileUploaderService","options","self","this","extendOptions","$","axios","prototype","extend","a","b","key","hasOwnProperty","init","getUploadInfo","attr","then","response","console","log","data","uploadInfo","setJqueryFileUploader","uploadUrl","replace","uploadCancelUrl","token","post","cancelUpload","alert","location","reload","fileupload","dataType","error","acceptFileTypes","formData","pkg","target_path","singleFileUploads","replaceFileInput","add","jqXHR","submit","uploadFolder","done","e","responseJSON","errorCode","errorInfo","modal","progressall","callback","progress","errorMessage","files","parseInt","val","loaded","file","name","html","css","errorThrown","index","on","abort","bind"],"mappings":"AAAA,YAEAA,QAAOC,QAML,SACA,0BACA,sBACA,qBAJC,SAAUC,GAWV,QAAAC,GAAAC,GAJCC,EAAOC,KAOPD,EAAAE,cAAAH,GACAA,EAAAA,OATF,GAAAC,GAGEA,EAFAA,EAAAA,GAAAL,OAAAQ,EAJEC,EAAQA,GAAST,OAAOS,KAoI5B,OArHMN,GAAIO,WAEHN,WACFO,OAAA,SAAAC,EAAAC,GACD,IAAA,GAAAC,KAAAD,GATkCA,EAAAE,eAAAD,KAWpCF,EAAAE,GAAAD,EAAAC,GAGE,OAAKH,IAGPK,cAAM,SAAYZ,GAChBC,KAAKY,QAAAA,KAALN,UAAAL,KAAAF,SACAI,KAAEG,OAAAL,KAAAF,QAAuBA,IAGzBK,KAAAA,WAEEJ,EAAAY,gBACAT,EAAA,kBAAUU,KAAA,YAAA,IAERb,cAAKD,WACLC,EAAAA,IAAKD,8BALRe,KAAK,SAAUC,GAOZC,GAAAA,GAAQC,EAARC,KAAAC,UALED,KAOFlB,EAAKoB,QAAAA,UAAAA,EAALC,UAAAC,QAAA,KAAA,UACDtB,EAAAD,QAAAwB,gBAAAL,EAAAK,gBAXHvB,EAAAD,QAAAyB,MAAAN,EAAAM,MAcFR,QAAAC,IAAAC,GAEEd,EAAMqB,4BAMJC,aAAA,WACAtB,EAAAqB,KAAAzB,EAAAD,QAAAwB,gBAAA,UAAAvB,EAAAD,QAAAyB,OANAA,MAAOxB,EAAKD,QAAQyB,QASpBV,KAAA,SAAAC,GANApB,OAAOgC,MAAM,UAQbhC,OAAAiC,SAAAC,WAUF1B,MAAE,SAAe2B,GACfC,QAAAA,IAAUC,MAGVC,sBAAiB,WACjBC,QAAAA,IAAUlC,EAAAD,SACRyB,EAAAA,eAAYzB,KAAAA,WADJC,EAAAD,QAAAsB,UAAA,UAAArB,EAAAD,QAAAyB,OAGRW,EAAAA,eAHQL,YAIRM,SAAAA,OAJQC,mBALgB,EAW1BC,YAAAA,EACAC,gBAAK,qBACHpC,UACEA,MAAEH,EAAAD,QAAFyB,MACArB,OAAE,QAPJgC,IAAK,QASHK,YAAQtB,EAAKuB,QAAbC,cAEHJ,kBAnByB,EAoB1BK,IAAAA,SAAMC,EAAA1B,GACJf,EAAA,kBAAmBe,IAAKsB,SAAMK,GAAAA,QAA9B,WAPE1C,EAAE,kBAAkBU,KAAK,YAAY,GASvCV,EAAI0C,kBAAa1B,KAAb,YAAkC2B,GAEpC3C,EAAEe,EAAAuB,YAGF9C,KAAAA,SAAAiD,EAAaC,GACd,GAAAA,GAAA3B,EAAAsB,MAAAK,YAED,UAAEA,EAAA1B,WAAuB4B,UAAYD,WACnCnD,OAAAgC,MAAA,UAhCsBxB,EAAA,iBAAA6C,MAAA,QAkC1BC,EAAAA,QAAaC,SAAAhC,IAETvB,OAAAgC,MAAAkB,EAAwBM,WAAWJ,UAArCK,cApCJjD,EAAA,kBAAAU,KAAA,YAAA,GAgCIV,EAAE,kBAAkBU,KAAK,YAAY,IAavCV,YAAYkD,SAAOT,EAAA1B,GACjBf,GAAEgD,GAAAG,SAAoBC,EAAIC,OAASC,EAAKC,MAAxC,IAAA,GADFvD,GAAA,mBAAAwD,KAAAR,EAAA,KAREhD,EAAE,uCAAuCyD,IAYzC,QACApB,EAAA,QAKFrC,EAAA,eAAS0D,KAAL,gBAA8B,SAAAjB,EAAA1B,GAChClB,EAAAA,KAAK0B,EAAAA,MAAL,SAAAoC,EAAAL,GACDtD,EAAA,oBAAAoD,IAAA,OAAAE,EAAAC,QArHPvD,EAAA,kBAAA4D,GAAA,QAAA,SAAAnB,GA8GQJ,EAAMwB,YAIV7D,EAAE,eAAe8D,KAAK,iBAAkB,SAAUrB,EAAG1B,GAC1B,UAArBA,EAAK2C,aACP7D,EAAK0B,mBAMN5B","file":"components/jquery_uploader_service.js","sourcesContent":["'use strict';\n\nwindow.define([\n  'common',\n  'jquery.iframe-transport',\n  'jquery-ui/ui/widget',\n  'jquery.fileupload'\n], function (Util) {\n  var self;\n  var $ = $ || window.$;\n  var axios = axios || window.axios;\n  var jqXHR;\n\n  function JqueryFileUploaderService (options) {\n    self = this;\n\n    self.extendOptions(options);\n    self.init();\n  }\n\n  JqueryFileUploaderService.prototype = {\n    // 옵션 저장 변수\n    options: {},\n    extend: function (a, b) {\n      for (var key in b) {\n        if (b.hasOwnProperty(key)) {\n          a[key] = b[key];\n        }\n      }\n      return a;\n    },\n    // 옵션 확장\n    extendOptions: function (options) {\n      this.options = this.extend({}, this.options);\n      this.extend(this.options, options);\n    },\n    // 컴포넌트 초기화\n    init: function () {\n      self.getUploadInfo();\n      $('#cancel-button').attr('disabled', true);\n    },\n    getUploadInfo: function () {\n      axios.get('/api/v1/fineuploader/token')\n      .then(function (response) {\n        var data = response.data.uploadInfo;\n        if (data) {\n          self.options.uploadUrl = data.uploadUrl.replace('v4', 'cdnovp');\n          self.options.uploadCancelUrl = data.uploadCancelUrl;\n          self.options.token = data.token;\n\n          console.log(data);\n\n          self.setJqueryFileUploader();\n        }\n      });\n    },\n    // 업로드를 취소한다.\n    cancelUpload: function () {\n      axios.post(self.options.uploadCancelUrl + '?token=' + self.options.token, {\n        token: self.options.token\n      })\n      .then(function (response) {\n        window.alert('업로드 취소');\n        window.location.reload();\n        // $('#upload-button').attr('disabled', false);\n        // $('#cancel-button').attr('disabled', true);\n\n        // $('#fileupload').fileupload('destroy');\n        // $('#fileupload').val('');\n\n        // self.getUploadInfo();\n      })\n      .catch(function (error) {\n        console.log(error);\n      });\n    },\n    setJqueryFileUploader: function () {\n      console.log(self.options);\n      $('#fileupload').attr('data-url', self.options.uploadUrl + '?token=' + self.options.token);\n\n      $('#fileupload').fileupload({\n        dataType: 'json',\n        singleFileUploads: true,\n        autoUpload: false,\n        acceptFileTypes: /(\\.|\\/)(mp4|avi)$/i,\n        formData: {\n          token: self.options.token,\n          folder: 2004661,\n          pkg: 1006241,\n          target_path: self.options.uploadFolder\n        },\n        replaceFileInput: false,\n        add: function (e, data) {\n          $('#upload-button').off('click').on('click', function () {\n            $('#upload-button').attr('disabled', true);\n            $('#cancel-button').attr('disabled', false);\n\n            jqXHR = data.submit();\n          });\n        },\n        done: function (e, data) {\n          var responseJSON = data.jqXHR.responseJSON;\n\n          if (responseJSON.uploadInfo.errorInfo.errorCode === 'None') {\n            window.alert('업로드 성공');\n            $('#fineUploader').modal('hide');\n            self.options.callback(data);\n          } else {\n            window.alert(responseJSON.uploadInfo.errorInfo.errorMessage);\n          }\n\n          $('#upload-button').attr('disabled', false);\n          $('#cancel-button').attr('disabled', true);\n        },\n        progressall: function (e, data) {\n          var progress = parseInt(data.loaded / data.total * 100, 10);\n          $('#progress-value').html(progress + '%');\n          $('#progress .jquery-file-progress-bar').css(\n              'width',\n              progress + '%'\n          );\n        }\n      });\n\n      $('#fileupload').bind('fileuploadadd', function (e, data) {\n        $.each(data.files, function (index, file) {\n          $('#aqua-video-code').val('onm_' + file.name);\n        });\n\n        $('#cancel-button').on('click', function (e) {\n          jqXHR.abort();\n        });\n      });\n\n      $('#fileupload').bind('fileuploadfail', function (e, data) {\n        if (data.errorThrown === 'abort') {\n          self.cancelUpload();\n        }\n      });\n    }\n  };\n\n  return JqueryFileUploaderService;\n});\n"],"sourceRoot":"/source/"}