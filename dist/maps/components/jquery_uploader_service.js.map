{"version":3,"sources":["components/jquery_uploader_service.js"],"names":["window","define","Util","JqueryFileUploaderService","options","self","this","extendOptions","$","axios","prototype","extend","a","b","key","hasOwnProperty","init","getUploadInfo","attr","response","folder_id","data","uploadUrl","uploadInfo","replace","uploadCancelUrl","setJqueryFileUploader","token","deploy_package_id","post","cancelUpload","then","alert","location","reload","catch","error","console","formData","log","uploadFolder","FormData","append","fileupload","dataType","singleFileUploads","autoUpload","jqXHR","replaceFileInput","add","e","done","off","on","responseJSON","submit","errorInfo","errorCode","modal","progressall","callback","progress","errorMessage","files","parseInt","val","loaded","file","name","html","css","errorThrown","index","abort","bind"],"mappings":"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","file":"components/jquery_uploader_service.js","sourcesContent":["'use strict';\n\nwindow.define([\n  'common',\n  'jquery.iframe-transport',\n  'jquery-ui/ui/widget',\n  'jquery.fileupload'\n], function (Util) {\n  var self;\n  var $ = $ || window.$;\n  var axios = axios || window.axios;\n  var jqXHR;\n\n  function JqueryFileUploaderService (options) {\n    self = this;\n\n    self.extendOptions(options);\n    self.init();\n  }\n\n  JqueryFileUploaderService.prototype = {\n    // 옵션 저장 변수\n    options: {},\n    extend: function (a, b) {\n      for (var key in b) {\n        if (b.hasOwnProperty(key)) {\n          a[key] = b[key];\n        }\n      }\n      return a;\n    },\n    // 옵션 확장\n    extendOptions: function (options) {\n      this.options = this.extend({}, this.options);\n      this.extend(this.options, options);\n    },\n    // 컴포넌트 초기화\n    init: function () {\n      self.getUploadInfo();\n      $('#cancel-button').attr('disabled', true);\n    },\n    getUploadInfo: function () {\n      axios.get('/api/v1/fineuploader/token')\n      .then(function (response) {\n        var data = response.data;\n        if (data) {\n          self.options.uploadUrl = data.uploadInfo.uploadUrl.replace('v4', 'cdnovp');\n          self.options.uploadCancelUrl = data.uploadInfo.uploadCancelUrl;\n          self.options.token = data.uploadInfo.token;\n          self.options.deploy_package_id = data.deploy_package_id;\n          self.options.folder_id = data.folder_id;\n\n          // console.log(data);\n\n          self.setJqueryFileUploader();\n        }\n      });\n    },\n    // 업로드를 취소한다.\n    cancelUpload: function () {\n      axios.post(self.options.uploadCancelUrl + '?token=' + self.options.token, {\n        token: self.options.token\n      })\n      .then(function (response) {\n        window.alert('업로드 취소');\n        window.location.reload();\n        // $('#upload-button').attr('disabled', false);\n        // $('#cancel-button').attr('disabled', true);\n\n        // $('#fileupload').fileupload('destroy');\n        // $('#fileupload').val('');\n\n        // self.getUploadInfo();\n      })\n      .catch(function (error) {\n        console.log(error);\n      });\n    },\n    setJqueryFileUploader: function () {\n      console.log(self.options);\n\n      $('#fileupload').attr('data-url', self.options.uploadUrl + '?token=' + self.options.token);\n\n      var formData = new window.FormData();\n      formData.append('token', self.options.token);\n      formData.append('folder', self.options.folder_id);\n      formData.append('pkg', self.options.deploy_package_id);\n      // formData.append('folder', 2004661);\n      // formData.append('pkg', 1006241);\n      formData.append('target_path', self.options.uploadFolder);\n      // formData.append('videofile', $('#fileupload').get(0).files[0], '123.mp4');\n\n      $('#fileupload').fileupload({\n        dataType: 'json',\n        singleFileUploads: true,\n        autoUpload: false,\n        acceptFileTypes: /(\\.|\\/)(mp4|avi)$/i,\n        formData: formData,\n        replaceFileInput: false,\n        add: function (e, data) {\n          $('#upload-button').off('click').on('click', function () {\n            $('#upload-button').attr('disabled', true);\n            $('#cancel-button').attr('disabled', false);\n\n            console.log(data);\n            jqXHR = data.submit();\n          });\n        },\n        done: function (e, data) {\n          var responseJSON = data.jqXHR.responseJSON;\n\n          if (responseJSON.uploadInfo.errorInfo.errorCode === 'None') {\n            window.alert('업로드 성공');\n            $('#fineUploader').modal('hide');\n            self.options.callback(data);\n          } else {\n            window.alert(responseJSON.uploadInfo.errorInfo.errorMessage);\n          }\n\n          $('#upload-button').attr('disabled', false);\n          $('#cancel-button').attr('disabled', true);\n        },\n        progressall: function (e, data) {\n          var progress = parseInt(data.loaded / data.total * 100, 10);\n          $('#progress-value').html(progress + '%');\n          $('#progress .jquery-file-progress-bar').css(\n              'width',\n              progress + '%'\n          );\n        }\n      });\n\n      $('#fileupload').bind('fileuploadadd', function (e, data) {\n        $.each(data.files, function (index, file) {\n          $('#aqua-video-code').val('onm_' + file.name);\n        });\n\n        $('#cancel-button').on('click', function (e) {\n          jqXHR.abort();\n        });\n      });\n\n      $('#fileupload').bind('fileuploadfail', function (e, data) {\n        if (data.errorThrown === 'abort') {\n          self.cancelUpload();\n        }\n      });\n\n      $('#fileupload').bind('fileuploadsubmit', function (e, data) {\n        // var formData = [\n        //   { name: 'token', value: self.options.token },\n        //   { name: 'folder', value: 2004661 },\n        //   { name: 'pkg', value: 1006241 },\n        //   { name: 'target_path', value: self.options.uploadFolder },\n        //   { name: 'videofile', value: $('#fileupload').get(0).files[0], filename: '123.mp4' }\n        // ];\n\n        // data.formData = formData;\n        // console.log(data.formData);\n        // data.formData.set('videofile', $('#fileupload').get(0).files[0], '123.mp4');\n      });\n    }\n  };\n\n  return JqueryFileUploaderService;\n});\n"],"sourceRoot":"/source/"}