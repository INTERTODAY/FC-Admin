{"version":3,"sources":["components/jquery_uploader_service.js"],"names":["window","define","Util","JqueryFileUploaderService","options","self","this","extendOptions","$","axios","prototype","extend","a","b","key","hasOwnProperty","init","getUploadInfo","attr","then","response","setJqueryFileUploader","data","uploadUrl","replace","uploadCancelUrl","token","post","error","alert","dataType","singleFileUploads","formData","pkg","fileupload","target_path","replaceFileInput","add","jqXHR","submit","uploadFolder","done","e","responseJSON","uploadInfo","errorCode","errorInfo","modal","progressall","callback","progress","errorMessage","files","parseInt","val","loaded","file","name","html","css","errorThrown","cancelUpload","index","on","abort","bind"],"mappings":"AAAA,YAEAA,QAAOC,QAML,SACA,0BACA,sBACA,qBAJC,SAAUC,GAWV,QAAAC,GAAAC,GAJCC,EAAOC,KAOPD,EAAAE,cAAAH,GACAA,EAAAA,OATF,GAAAC,GAGEA,EAFAA,EAAAA,GAAAL,OAAAQ,EAJEC,EAAQA,GAAST,OAAOS,KA4H5B,OA7GMN,GAAIO,WAEHN,WACFO,OAAA,SAAAC,EAAAC,GACD,IAAA,GAAAC,KAAAD,GATkCA,EAAAE,eAAAD,KAWpCF,EAAAE,GAAAD,EAAAC,GAGE,OAAKH,IAGPK,cAAM,SAAYZ,GAChBC,KAAKY,QAAAA,KAALN,UAAAL,KAAAF,SACAI,KAAEG,OAAAL,KAAAF,QAAuBA,IAGzBK,KAAAA,WAEEJ,EAAAY,gBACAT,EAAA,kBAAUU,KAAA,YAAA,IAERb,cAAKD,WACLC,EAAAA,IAAKD,8BALRe,KAAK,SAAUC,GAOZf,GAAAA,GAAKgB,EAAAA,KAAAA,UACNC,KATHjB,EAAAD,QAAAmB,UAAAD,EAAAC,UAAAC,QAAA,KAAA,UAtBkCnB,EAAAD,QAAAqB,gBAAAH,EAAAG,gBAkCpCpB,EAAAD,QAAAsB,MAAAJ,EAAAI,MAEEjB,EAAMkB,4BAMJnB,aAAE,WACFH,EAAAA,KAAKY,EAAAA,QAALQ,gBAAA,UAAApB,EAAAD,QAAAsB,OAPFA,MASOrB,EAAAD,QAAUwB,QATjBT,KAAA,SAAAC,GApCkCpB,OAAA6B,MAAA,UAiDpCR,EAAAA,kBAAuBH,KAAA,YAAA,GACnBV,EAAA,kBAAoBU,KAAA,YAAiBd,GAPrCC,EAAKY,kBAULa,MAAAA,SAAUF,GACVG,QAAAA,IAAAA,MAGAC,sBAAU,WACRN,EAAAA,eAAYtB,KAAAA,WADJC,EAAAD,QAAAmB,UAAA,UAAAlB,EAAAD,QAAAsB,OAGRO,EAAAA,eAHQC,YAIRC,SAAAA,OAJQJ,mBALgB,EAW1BK,YAAAA,EACAC,gBAAK,qBACH7B,UACEA,MAAEH,EAAAD,QAAFsB,MACAlB,OAAE,QAPJyB,IAAK,QASHK,YAAQhB,EAAKiB,QAAbC,cAEHJ,kBAnByB,EAoB1BK,IAAAA,SAAMC,EAAApB,GACJd,EAAA,kBAAmBc,IAAKgB,SAAMK,GAAAA,QAA9B,WAPEnC,EAAE,kBAAkBU,KAAK,YAAY,GASvCV,EAAImC,kBAAaC,KAAb,YAAkCC,GAEpCrC,EAAEc,EAAAiB,YAGFvC,KAAAA,SAAA0C,EAAaC,GACd,GAAAA,GAAArB,EAAAgB,MAAAK,YAED,UAAEA,EAAAC,WAAuBE,UAAYD,WACnC7C,OAAA6B,MAAA,UAhCsBrB,EAAA,iBAAAuC,MAAA,QAkC1BC,EAAAA,QAAaC,SAAA3B,IAETtB,OAAA6B,MAAAc,EAAwBO,WAAWJ,UAArCK,cApCJ3C,EAAA,kBAAAU,KAAA,YAAA,GAgCIV,EAAE,kBAAkBU,KAAK,YAAY,IAavCV,YAAY4C,SAAOV,EAAApB,GACjBd,GAAE0C,GAAAG,SAAoBC,EAAIC,OAASC,EAAKC,MAAxC,IAAA,GADFjD,GAAA,mBAAAkD,KAAAR,EAAA,KARE1C,EAAE,uCAAuCmD,IAYzC,QACArB,EAAA,QAKF9B,EAAA,eAASoD,KAAL,gBAA8B,SAAAlB,EAAApB,GAChCjB,EAAAA,KAAKwD,EAAAA,MAAL,SAAAC,EAAAN,GACDhD,EAAA,oBAAA8C,IAAA,OAAAE,EAAAC,QA7GPjD,EAAA,kBAAAuD,GAAA,QAAA,SAAArB,GAsGQJ,EAAM0B,YAIVxD,EAAE,eAAeyD,KAAK,iBAAkB,SAAUvB,EAAGpB,GAC1B,UAArBA,EAAKsC,aACPvD,EAAKwD,mBAMN1D","file":"components/jquery_uploader_service.js","sourcesContent":["'use strict';\n\nwindow.define([\n  'common',\n  'jquery.iframe-transport',\n  'jquery-ui/ui/widget',\n  'jquery.fileupload'\n], function (Util) {\n  var self;\n  var $ = $ || window.$;\n  var axios = axios || window.axios;\n  var jqXHR;\n\n  function JqueryFileUploaderService (options) {\n    self = this;\n\n    self.extendOptions(options);\n    self.init();\n  }\n\n  JqueryFileUploaderService.prototype = {\n    // 옵션 저장 변수\n    options: {},\n    extend: function (a, b) {\n      for (var key in b) {\n        if (b.hasOwnProperty(key)) {\n          a[key] = b[key];\n        }\n      }\n      return a;\n    },\n    // 옵션 확장\n    extendOptions: function (options) {\n      this.options = this.extend({}, this.options);\n      this.extend(this.options, options);\n    },\n    // 컴포넌트 초기화\n    init: function () {\n      self.getUploadInfo();\n      $('#cancel-button').attr('disabled', true);\n    },\n    getUploadInfo: function () {\n      axios.get('/api/v1/fineuploader/token')\n      .then(function (response) {\n        var data = response.data.uploadInfo;\n        if (data) {\n          self.options.uploadUrl = data.uploadUrl.replace('v4', 'cdnovp');\n          self.options.uploadCancelUrl = data.uploadCancelUrl;\n          self.options.token = data.token;\n\n          self.setJqueryFileUploader();\n        }\n      });\n    },\n    // 업로드를 취소한다.\n    cancelUpload: function () {\n      axios.post(self.options.uploadCancelUrl + '?token=' + self.options.token, {\n        token: self.options.token\n      })\n      .then(function (response) {\n        window.alert('업로드 취소');\n        $('#upload-button').attr('disabled', false);\n        $('#cancel-button').attr('disabled', true);\n        self.getUploadInfo();\n      })\n      .catch(function (error) {\n        console.log(error);\n      });\n    },\n    setJqueryFileUploader: function () {\n      $('#fileupload').attr('data-url', self.options.uploadUrl + '?token=' + self.options.token);\n\n      $('#fileupload').fileupload({\n        dataType: 'json',\n        singleFileUploads: true,\n        autoUpload: false,\n        acceptFileTypes: /(\\.|\\/)(mp4|avi)$/i,\n        formData: {\n          token: self.options.token,\n          folder: 2004661,\n          pkg: 1006241,\n          target_path: self.options.uploadFolder\n        },\n        replaceFileInput: false,\n        add: function (e, data) {\n          $('#upload-button').off('click').on('click', function () {\n            $('#upload-button').attr('disabled', true);\n            $('#cancel-button').attr('disabled', false);\n\n            jqXHR = data.submit();\n          });\n        },\n        done: function (e, data) {\n          var responseJSON = data.jqXHR.responseJSON;\n\n          if (responseJSON.uploadInfo.errorInfo.errorCode === 'None') {\n            window.alert('업로드 성공');\n            $('#fineUploader').modal('hide');\n            self.options.callback(data);\n          } else {\n            window.alert(responseJSON.uploadInfo.errorInfo.errorMessage);\n          }\n\n          $('#upload-button').attr('disabled', false);\n          $('#cancel-button').attr('disabled', true);\n        },\n        progressall: function (e, data) {\n          var progress = parseInt(data.loaded / data.total * 100, 10);\n          $('#progress-value').html(progress + '%');\n          $('#progress .jquery-file-progress-bar').css(\n              'width',\n              progress + '%'\n          );\n        }\n      });\n\n      $('#fileupload').bind('fileuploadadd', function (e, data) {\n        $.each(data.files, function (index, file) {\n          $('#aqua-video-code').val('onm_' + file.name);\n        });\n\n        $('#cancel-button').on('click', function (e) {\n          jqXHR.abort();\n        });\n      });\n\n      $('#fileupload').bind('fileuploadfail', function (e, data) {\n        if (data.errorThrown === 'abort') {\n          self.cancelUpload();\n        }\n      });\n    }\n  };\n\n  return JqueryFileUploaderService;\n});\n"],"sourceRoot":"/source/"}