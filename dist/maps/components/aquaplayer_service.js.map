{"version":3,"sources":["components/aquaplayer_service.js"],"names":["window","define","self","Util","NplayerWrapperTemplate","ax","AquaPlayerService","options","this","extend","init","$","prototype","a","b","key","extendOptions","initPlayer","resize","getEncodedParam","initPlayerHTML","html","player","controlBox","visible","NPlayer","initNPlayerUI","proxy_init","setPlayerStart","setNPlayer","reportMessage","setMediaInfo","url","getMediaURL","encodeURI","encodedParam","genkey","indicateInstall","indicateUpdate","bindEvent","OpenState","Opened","state","setVisible","starthtml5State","Closed","Stophtml5State","PlayState","Playing","Stopped","Paused","name","desc","initPlayerWindow","ec","setAxPlugin","setCDNAuthParam","addContextMenu","console","fileUrl","open","URL","isDup","AquaAxPlugin","alert","NPLAYER_DUP_MSG","LoadSystemInfomation","val","onunload","height","res","data","encparam","catch","err","reportError","msg","log","getFullscreen"],"mappings":"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","file":"components/aquaplayer_service.js","sourcesContent":["'use strict';\nwindow.define([\n  'common',\n  'text!../../../nplayer_wrapper.html',\n  'axplugin',\n  'nplayer',\n  'nplayer_ui',\n  'cdnproxy',\n  'nplayer_conf'\n], function (Util, NplayerWrapperTemplate, ax) {\n  var self = null;\n  var encodedParam;\n  var player;\n  var $ = $ || window.$;\n\n  function AquaPlayerService (options) {\n    self = this;\n\n    self.extendOptions(options);\n    self.init();\n  }\n\n  AquaPlayerService.prototype = {\n    // 옵션 저장 변수\n    options: {},\n    extend: function (a, b) {\n      for (var key in b) {\n        if (b.hasOwnProperty(key)) {\n          a[key] = b[key];\n        }\n      }\n      return a;\n    },\n    // 옵션 확장\n    extendOptions: function (options) {\n      this.options = this.extend({}, this.options);\n      this.extend(this.options, options);\n    },\n    // 컴포넌트 초기화\n    init: function () {\n      self.getEncodedParam();\n    },\n    initPlayer: function () {\n      self.resize();\n\n      if (self.options.html) {\n        self.initPlayerHTML();\n      } else if ('ActiveXObject' in window) {\n        self.initPlayerWindow();\n      }\n    },\n    // Player 초기화\n    initPlayerHTML: function () {\n      player = new window.NPlayer('video', {\n        controlBox: 'nplayer_control.html',\n        visible: false,\n        mode: 'html5'\n      });\n\n      // player.setWatermarkText('watermark');\n\n      window.player = player;\n\n      window.initNPlayerUI(player);\n\n      player.bindEvent('Ready', function () {\n        self.reportMessage('ready');\n\n        window.proxy_init(function () {\n          // 1. video start set\n          window.setPlayerStart(true);\n          // 2. nplayer instance set\n          window.setNPlayer(player);\n          // 4. media info set\n          window.mygentAuthCall(function (genkey) {\n            window.setMediaInfo(self.options.fileUrl, genkey);\n\n            var url = window.getMediaURL(false);\n            player.open({\n              'URL': window.encodeURI(url)\n            });\n          }, encodedParam);\n        }, window.indicateInstall, window.indicateUpdate);\n      });\n\n      player.bindEvent('OpenStateChanged', function (state) {\n        self.reportMessage('OpenStateChanged');\n\n        switch (state) {\n        case window.NPlayer.OpenState.Opened:\n          player.setVisible(true);\n          window.starthtml5State();\n          break;\n        case window.NPlayer.OpenState.Closed:\n          window.Stophtml5State(window.NPlayer.OpenState.Closed);\n          break;\n        }\n      });\n\n      player.bindEvent('PlayStateChanged', function (state) {\n        self.reportMessage('PlayStateChanged');\n\n        switch (state) {\n        case window.NPlayer.PlayState.Playing:\n          player.setVisible(true);\n          break;\n\n        case window.NPlayer.PlayState.Stopped:\n          player.setVisible(false);\n          break;\n\n        case window.NPlayer.PlayState.Paused:\n          player.setVisible(true);\n          break;\n        }\n      });\n\n      player.bindEvent('GuardCallback', function (name, desc) {\n        self.reportMessage('GuardCallback - ' + name + ' : ' + desc);\n      });\n\n      player.bindEvent('Error', function (ec) {\n        self.reportMessage('Error - ' + ec);\n      });\n    },\n    initPlayerWindow: function () {\n      // self.options.fileUrl = 'http://eng-media-02.cdngc.net/cdnlab/cs1/tsbox/CSS_1500k.mp4';\n\n      player = new window.NPlayer('video', {\n        controlBox: 'nplayer_control.html',\n        visible: false\n      });\n      var setAxPlugin = false;\n\n      // player.setWatermarkText('watermark');\n\n      window.player = player;\n\n      window.initNPlayerUI(player);\n\n      player.bindEvent('Ready', function () {\n        self.reportMessage('Ready');\n\n        player.setCDNAuthParam(encodedParam);\n        // player.setCDNAuthParam('pwClNIt9VvCLi88GmznRuVVXxQy6cZ6CRz3Mdlccyyp4UVmt+Pznd+KrwhKL5X/jWC1jdbs2oOwpPKDRlZconDIqHNlt5vcJhEEfl7AOZ28QqYtnve5PZOGv9Zaok/37ju9VYKOfm8I8H9LhBueExOWruaBEUISJprfPCjRoIwvCA0wpyca7Y2nZ8CE4Q7QM1A4MZXdbTvtRDADEOJSSw/T6eNnFbI3hsU3po3WN6luWKg3gi3X/maxv0gd59+rr+1cCyOevi4OsRenHpQgR6MEdwJPVrCjcG+lv7yEBK+hvY2tJZD0x');\n        player.addContextMenu('SystemInfo', 'sysinfo');\n\n        console.log(window.encodeURI(self.options.fileUrl));\n\n        player.open({\n          'URL': window.encodeURI(self.options.fileUrl)\n        });\n      });\n\n      player.bindEvent('OpenStateChanged', function (state) {\n        self.reportMessage('OpenStateChanged', state);\n\n        switch (state) {\n        case window.NPlayer.OpenState.Opened:\n          player.setVisible(true);\n          break;\n        case window.NPlayer.OpenState.Closed:\n          break;\n        }\n      });\n\n      player.bindEvent('PlayStateChanged', function (state) {\n        self.reportMessage('PlayStateChanged', state);\n\n        switch (state) {\n        case window.NPlayer.PlayState.Playing:\n          player.setVisible(true);\n\n          if (ax.isDup === true) {\n            player.stop();\n            window.alert(window.NPLAYER_DUP_MSG);\n            break;\n          }\n\n          if (setAxPlugin === true) {\n            window.AquaAxPlugin.PlayState = window.NPlayer.PlayState.Playing;\n            window.AquaAxPlugin.OpenStateChange();\n          }\n          break;\n\n        case window.NPlayer.PlayState.Stopped:\n          player.setVisible(false);\n          break;\n\n        case window.NPlayer.PlayState.Paused:\n          player.setVisible(true);\n\n          if (setAxPlugin === true) {\n            window.AquaAxPlugin.PlayState = window.NPlayer.PlayState.Paused;\n            window.AquaAxPlugin.OpenStateChange();\n          }\n          break;\n        }\n      });\n\n      player.bindEvent('GuardCallback', function (name, desc) {\n        if (setAxPlugin === true) window.AquaAxPlugin.SendPVLog(name, desc);\n      });\n\n      player.bindEvent('Error', function (ec) {\n        $('#video').css('background-image', 'none');\n      });\n\n      player.bindEvent('ContextMenu', function (val) {\n        if (val === 'sysinfo') {\n          if (setAxPlugin === true) {\n            window.AquaAxPlugin.LoadSystemInfomation();\n            window.alert(\n              'CPU 정보 : ' + window.AquaAxPlugin.DeviceCPU + '\\n' +\n              'MEM 정보 : ' + window.AquaAxPlugin.DeviceMem + '\\n' +\n              'GPU 정보 : ' + window.AquaAxPlugin.DeviceGPU + '\\n\\n' +\n              'IP 정보 : ' + window.AquaAxPlugin.DeviceIP + '\\n' +\n              'Mac 정보 : ' + window.AquaAxPlugin.DeviceMac + '\\n' +\n              'OS 정보 : ' + window.AquaAxPlugin.DeviceOSDesc + '\\n' +\n              '해상도 정보 : ' + window.AquaAxPlugin.DeviceMonitor + '\\n' +\n              'IE 버전 : ' + window.AquaAxPlugin.DeviceIE + '\\n'\n            );\n          }\n        }\n      });\n\n      window.onunload = function () {\n        if (setAxPlugin === true) window.AquaAxPlugin.FinalizeAuth();\n      };\n    },\n    // encparam 을 서버에서 생성하여 전달받는다.\n    getEncodedParam: function () {\n      window.axios.get('/api/v1/player/encparam')\n        .then(function (res) {\n          encodedParam = res.data.encparam;\n          self.reportMessage(encodedParam);\n          self.initPlayer();\n        })\n        .catch(function (err) {\n          self.reportError(err);\n        }\n      );\n    },\n    reportMessage: function (msg) {\n      console.log('aquaservice : ' + msg);\n    },\n    reportError: function (err) {\n      console.log('aquaservice : ' + err);\n    },\n    resize: function () {\n      $(window).resize(function () {\n        if (player && !!player.getFullscreen()) {\n          $('#video').height($(window).height());\n        } else {\n          $('#video').height($(window).height() - $('.wrapper_foot').height());\n        }\n      });\n    }\n  };\n\n  return AquaPlayerService;\n});\n"],"sourceRoot":"/source/"}