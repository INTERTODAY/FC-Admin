{"version":3,"sources":["components/aquaplayer_service.js"],"names":["window","define","self","Util","NplayerWrapperTemplate","ax","AquaPlayerService","options","this","extend","init","$","prototype","a","b","key","extendOptions","initPlayer","resize","initPlayerHTML","player","visible","NPlayer","initNPlayerUI","proxy_init","setPlayerStart","setNPlayer","reportMessage","setMediaInfo","url","getMediaURL","encodeURI","encodedParam","genkey","indicateInstall","indicateUpdate","bindEvent","OpenState","Opened","state","setVisible","starthtml5State","Closed","Stophtml5State","PlayState","Playing","Stopped","Paused","name","desc","initPlayerWindow","ec","mode","controlBox","setCDNAuthParam","open","URL","fileUrl","isDup","AquaAxPlugin","alert","NPLAYER_DUP_MSG","OpenStateChange","setAxPlugin","SendPVLog","LoadSystemInfomation","val","onunload","DeviceCPU","DeviceMem","DeviceGPU","DeviceIP","data","encparam","DeviceMac","DeviceOSDesc","DeviceMonitor","err","DeviceIE","reportError","FinalizeAuth","height","res","catch","msg","console","log","getFullscreen"],"mappings":"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","file":"components/aquaplayer_service.js","sourcesContent":["'use strict';\nwindow.define([\n  'common',\n  'text!../../../nplayer_wrapper.html',\n  'axplugin',\n  'nplayer',\n  'nplayer_ui',\n  'cdnproxy',\n  'nplayer_conf'\n], function (Util, NplayerWrapperTemplate, ax) {\n  var self = null;\n  var encodedParam;\n  var player;\n  var $ = $ || window.$;\n\n  function AquaPlayerService (options) {\n    self = this;\n\n    self.extendOptions(options);\n    self.init();\n  }\n\n  AquaPlayerService.prototype = {\n    // 옵션 저장 변수\n    options: {},\n    extend: function (a, b) {\n      for (var key in b) {\n        if (b.hasOwnProperty(key)) {\n          a[key] = b[key];\n        }\n      }\n      return a;\n    },\n    // 옵션 확장\n    extendOptions: function (options) {\n      this.options = this.extend({}, this.options);\n      this.extend(this.options, options);\n    },\n    // 컴포넌트 초기화\n    init: function () {\n      self.getEncodedParam();\n      self.resize();\n    },\n    initPlayer: function () {\n      if ('ActiveXObject' in window) {\n        self.initPlayerWindow();\n      } else {\n        self.initPlayerHTML();\n      }\n    },\n    // Player 초기화\n    initPlayerHTML: function () {\n      player = new window.NPlayer('video', {\n        controlBox: 'nplayer_control.html',\n        visible: false,\n        mode: 'html5'\n      });\n\n      // player.setWatermarkText('watermark');\n\n      window.player = player;\n\n      window.initNPlayerUI(player);\n\n      player.bindEvent('Ready', function () {\n        self.reportMessage('ready');\n\n        window.proxy_init(function () {\n          // 1. video start set\n          window.setPlayerStart(true);\n          // 2. nplayer instance set\n          window.setNPlayer(player);\n          // 4. media info set\n          window.mygentAuthCall(function (genkey) {\n            window.setMediaInfo(self.options.fileUrl, genkey);\n\n            var url = window.getMediaURL(false);\n            player.open({\n              'URL': window.encodeURI(url)\n            });\n          }, encodedParam);\n        }, window.indicateInstall, window.indicateUpdate);\n      });\n\n      player.bindEvent('OpenStateChanged', function (state) {\n        self.reportMessage('OpenStateChanged');\n\n        switch (state) {\n        case window.NPlayer.OpenState.Opened:\n          player.setVisible(true);\n          window.starthtml5State();\n          break;\n        case window.NPlayer.OpenState.Closed:\n          window.Stophtml5State(window.NPlayer.OpenState.Closed);\n          break;\n        }\n      });\n\n      player.bindEvent('PlayStateChanged', function (state) {\n        self.reportMessage('PlayStateChanged');\n\n        switch (state) {\n        case window.NPlayer.PlayState.Playing:\n          player.setVisible(true);\n          break;\n\n        case window.NPlayer.PlayState.Stopped:\n          player.setVisible(false);\n          break;\n\n        case window.NPlayer.PlayState.Paused:\n          player.setVisible(true);\n          break;\n        }\n      });\n\n      player.bindEvent('GuardCallback', function (name, desc) {\n        self.reportMessage('GuardCallback - ' + name + ' : ' + desc);\n      });\n\n      player.bindEvent('Error', function (ec) {\n        self.reportMessage('Error - ' + ec);\n      });\n    },\n    initPlayerWindow: function () {\n      player = new window.NPlayer('video', {\n        controlBox: 'nplayer_control.html',\n        visible: false,\n        mode: 'html5'\n      });\n      // var setAxPlugin = false;\n\n      // player.setWatermarkText('watermark');\n\n      window.player = player;\n\n      window.initNPlayerUI(player);\n\n      player.bindEvent('Ready', function () {\n        self.reportMessage('Ready');\n\n        player.setCDNAuthParam(encodedParam);\n        player.addContextMenu('SystemInfo', 'sysinfo');\n\n        player.open({\n          'URL': encodeURI(self.options.fileUrl)\n        });\n      });\n\n      player.bindEvent('OpenStateChanged', function (state) {\n        self.reportMessage('OpenStateChanged');\n\n        switch (state) {\n        case window.NPlayer.OpenState.Opened:\n          player.setVisible(true);\n          break;\n        case window.NPlayer.OpenState.Closed:\n          break;\n        }\n      });\n\n      player.bindEvent('PlayStateChanged', function (state) {\n        self.reportMessage('PlayStateChanged');\n\n        switch (state) {\n        case window.NPlayer.PlayState.Playing:\n          player.setVisible(true);\n\n          if (ax.isDup === true) {\n            player.stop();\n            window.alert(window.NPLAYER_DUP_MSG);\n            break;\n          }\n\n          if (setAxPlugin === true) {\n            window.AquaAxPlugin.PlayState = window.NPlayer.PlayState.Playing;\n            window.AquaAxPlugin.OpenStateChange();\n          }\n          break;\n\n        case window.NPlayer.PlayState.Stopped:\n          player.setVisible(false);\n          break;\n\n        case window.NPlayer.PlayState.Paused:\n          player.setVisible(true);\n\n          if (setAxPlugin === true) {\n            window.AquaAxPlugin.PlayState = window.NPlayer.PlayState.Paused;\n            window.AquaAxPlugin.OpenStateChange();\n          }\n          break;\n        }\n      });\n\n      player.bindEvent('GuardCallback', function (name, desc) {\n        if (setAxPlugin === true) window.AquaAxPlugin.SendPVLog(name, desc);\n      });\n\n      player.bindEvent('Error', function (ec) {\n        $('#video').css('background-image', 'none');\n      });\n\n      player.bindEvent('ContextMenu', function (val) {\n        if (val === 'sysinfo') {\n          if (setAxPlugin === true) {\n            window.AquaAxPlugin.LoadSystemInfomation();\n            window.alert(\n              'CPU 정보 : ' + window.AquaAxPlugin.DeviceCPU + '\\n' +\n              'MEM 정보 : ' + window.AquaAxPlugin.DeviceMem + '\\n' +\n              'GPU 정보 : ' + window.AquaAxPlugin.DeviceGPU + '\\n\\n' +\n              'IP 정보 : ' + window.AquaAxPlugin.DeviceIP + '\\n' +\n              'Mac 정보 : ' + window.AquaAxPlugin.DeviceMac + '\\n' +\n              'OS 정보 : ' + window.AquaAxPlugin.DeviceOSDesc + '\\n' +\n              '해상도 정보 : ' + window.AquaAxPlugin.DeviceMonitor + '\\n' +\n              'IE 버전 : ' + window.AquaAxPlugin.DeviceIE + '\\n'\n            );\n          }\n        }\n      });\n\n      window.onunload = function () {\n        if (setAxPlugin === true) window.AquaAxPlugin.FinalizeAuth();\n      };\n    },\n    // encparam 을 서버에서 생성하여 전달받는다.\n    getEncodedParam: function () {\n      window.axios.get('/api/v1/player/encparam')\n        .then(function (res) {\n          encodedParam = res.data.encparam;\n          self.reportMessage(encodedParam);\n          self.initPlayer();\n        })\n        .catch(function (err) {\n          self.reportError(err);\n        }\n      );\n    },\n    reportMessage: function (msg) {\n      console.log('aquaservice : ' + msg);\n    },\n    reportError: function (err) {\n      console.log('aquaservice : ' + err);\n    },\n    resize: function () {\n      $(window).resize(function () {\n        if (player && !!player.getFullscreen()) {\n          $('#video').height($(window).height());\n        } else {\n          $('#video').height($(window).height() - $('.wrapper_foot').height());\n        }\n      });\n    }\n  };\n\n  return AquaPlayerService;\n});\n"],"sourceRoot":"/source/"}