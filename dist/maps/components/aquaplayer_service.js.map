{"version":3,"sources":["components/aquaplayer_service.js"],"names":["window","define","AquaPlayerService","options","extend","self","encodedParam","a","b","key","hasOwnProperty","extendOptions","getEncodedParam","this","initPlayer","init","initPlayerWindow","resize","html5","initPlayerHTML","controlBox","player","NPlayer","mode","initNPlayerUI","bindEvent","mygentAuthCall","setPlayerStart","genkey","fileUrl","url","getMediaURL","open","encodeURI","state","indicateUpdate","starthtml5State","reportMessage","OpenState","Opened","setVisible","Closed","PlayState","Playing","Stopped","Paused","name","desc","ec","testWatermark","visible","setCDNAuthParam","addContextMenu","console","log","URL","setAxPlugin","$","val","AquaAxPlugin","LoadSystemInfomation","then","height","catch","err","reportError","setWatermarkColor","setWatermarkInterval","testSubtitle1","getFullscreen","setTimeout","setSubtitleColor","setWatermarkText","testSubtitle2","setWatermarkSize","testSubtitle3","setSubtitleFont","setSubtitlePosition","setSubtitleText"],"mappings":"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","file":"components/aquaplayer_service.js","sourcesContent":["'use strict';\nwindow.define([\n  'jquery',\n  'axplugin',\n  'nplayer',\n  'nplayer_ui',\n  'cdnproxy',\n  'nplayer_conf'\n], function ($, ax) {\n  var self = null;\n  var encodedParam;\n  var player;\n  // var $ = $ || window.$;\n\n  function AquaPlayerService (options) {\n    self = this;\n\n    self.extendOptions(options);\n    self.init();\n  }\n\n  AquaPlayerService.prototype = {\n    // 옵션 저장 변수\n    options: {},\n    extend: function (a, b) {\n      for (var key in b) {\n        if (b.hasOwnProperty(key)) {\n          a[key] = b[key];\n        }\n      }\n      return a;\n    },\n    // 옵션 확장\n    extendOptions: function (options) {\n      this.options = this.extend({}, this.options);\n      this.extend(this.options, options);\n    },\n    // 컴포넌트 초기화\n    init: function () {\n      self.getEncodedParam();\n    },\n    initPlayer: function () {\n      self.resize();\n\n      if (self.options.html5) {\n        self.initPlayerHTML();\n      } else if ('ActiveXObject' in window) {\n        self.initPlayerWindow();\n      }\n    },\n    // Player 초기화\n    initPlayerHTML: function () {\n      player = new window.NPlayer('video', {\n        controlBox: 'nplayer_control.html',\n        visible: false,\n        mode: 'html5'\n      });\n\n      // player.setWatermarkText('watermark');\n\n      window.player = player;\n\n      window.initNPlayerUI(player);\n\n      player.bindEvent('Ready', function () {\n        self.reportMessage('ready');\n\n        window.proxy_init(function () {\n          // 1. video start set\n          window.setPlayerStart(true);\n          // 2. nplayer instance set\n          window.setNPlayer(player);\n          // 4. media info set\n          window.mygentAuthCall(function (genkey) {\n            window.setMediaInfo(self.options.fileUrl, genkey);\n\n            var url = window.getMediaURL(false);\n            player.open({\n              'URL': window.encodeURI(url)\n            });\n          }, encodedParam);\n        }, window.indicateInstall, window.indicateUpdate);\n      });\n\n      player.bindEvent('OpenStateChanged', function (state) {\n        self.reportMessage('OpenStateChanged');\n\n        switch (state) {\n        case window.NPlayer.OpenState.Opened:\n          player.setVisible(true);\n          window.starthtml5State();\n          break;\n        case window.NPlayer.OpenState.Closed:\n          window.Stophtml5State(window.NPlayer.OpenState.Closed);\n          break;\n        }\n      });\n\n      player.bindEvent('PlayStateChanged', function (state) {\n        self.reportMessage('PlayStateChanged');\n\n        switch (state) {\n        case window.NPlayer.PlayState.Playing:\n          player.setVisible(true);\n          break;\n\n        case window.NPlayer.PlayState.Stopped:\n          player.setVisible(false);\n          break;\n\n        case window.NPlayer.PlayState.Paused:\n          player.setVisible(true);\n          break;\n        }\n      });\n\n      player.bindEvent('GuardCallback', function (name, desc) {\n        self.reportMessage('GuardCallback - ' + name + ' : ' + desc);\n      });\n\n      player.bindEvent('Error', function (ec) {\n        self.reportMessage('Error - ' + ec);\n      });\n    },\n    initPlayerWindow: function () {\n      // self.options.fileUrl = 'http://eng-media-02.cdngc.net/cdnlab/cs1/tsbox/CSS_1500k.mp4';\n\n      player = new window.NPlayer('video', {\n        controlBox: 'nplayer_control.html',\n        visible: false\n      });\n      var setAxPlugin = false;\n\n      window.player = player;\n      self.testWatermark();\n\n      window.initNPlayerUI(player);\n\n      player.bindEvent('Ready', function () {\n        self.reportMessage('Ready');\n\n        // if (ax.loadAquaAxPlugin()) {\n        player.setCDNAuthParam(encodedParam);\n        // player.setCDNAuthParam('pwClNIt9VvCLi88GmznRuVVXxQy6cZ6CRz3Mdlccyyp4UVmt+Pznd+KrwhKL5X/jWC1jdbs2oOwpPKDRlZconDIqHNlt5vcJhEEfl7AOZ28QqYtnve5PZOGv9Zaok/37ju9VYKOfm8I8H9LhBueExOWruaBEUISJprfPCjRoIwvCA0wpyca7Y2nZ8CE4Q7QM1A4MZXdbTvtRDADEOJSSw/T6eNnFbI3hsU3po3WN6luWKg3gi3X/maxv0gd59+rr+1cCyOevi4OsRenHpQgR6MEdwJPVrCjcG+lv7yEBK+hvY2tJZD0x');\n        player.addContextMenu('SystemInfo', 'sysinfo');\n\n        console.log(window.encodeURI(self.options.fileUrl));\n\n        player.open({\n          'URL': window.encodeURI(self.options.fileUrl)\n        });\n\n          // setAxPlugin = ax.setAquaAxPlugin(this.options.fileUrl, encodedParam);\n        // }\n      });\n\n      player.bindEvent('OpenStateChanged', function (state) {\n        self.reportMessage('OpenStateChanged');\n\n        switch (state) {\n        case window.NPlayer.OpenState.Opened:\n          player.setVisible(true);\n          break;\n        case window.NPlayer.OpenState.Closed:\n          break;\n        }\n      });\n\n      player.bindEvent('PlayStateChanged', function (state) {\n        self.reportMessage('PlayStateChanged');\n\n        switch (state) {\n        case window.NPlayer.PlayState.Playing:\n          player.setVisible(true);\n\n          // if (ax.isDup === true) {\n          //   player.stop();\n          //   window.alert(window.NPLAYER_DUP_MSG);\n          //   break;\n          // }\n\n          if (setAxPlugin === true) {\n            window.AquaAxPlugin.PlayState = window.NPlayer.PlayState.Playing;\n            window.AquaAxPlugin.OpenStateChange();\n          }\n          break;\n\n        case window.NPlayer.PlayState.Stopped:\n          player.setVisible(false);\n          break;\n\n        case window.NPlayer.PlayState.Paused:\n          player.setVisible(true);\n\n          if (setAxPlugin === true) {\n            window.AquaAxPlugin.PlayState = window.NPlayer.PlayState.Paused;\n            window.AquaAxPlugin.OpenStateChange();\n          }\n          break;\n        }\n      });\n\n      player.bindEvent('GuardCallback', function (name, desc) {\n        if (setAxPlugin === true) window.AquaAxPlugin.SendPVLog(name, desc);\n      });\n\n      player.bindEvent('Error', function (ec) {\n        console.log('err', ec);\n        $('#video').css('background-image', 'none');\n      });\n\n      player.bindEvent('ContextMenu', function (val) {\n        if (val === 'sysinfo') {\n          if (setAxPlugin === true) {\n            window.AquaAxPlugin.LoadSystemInfomation();\n            window.alert(\n              'CPU 정보 : ' + window.AquaAxPlugin.DeviceCPU + '\\n' +\n              'MEM 정보 : ' + window.AquaAxPlugin.DeviceMem + '\\n' +\n              'GPU 정보 : ' + window.AquaAxPlugin.DeviceGPU + '\\n\\n' +\n              'IP 정보 : ' + window.AquaAxPlugin.DeviceIP + '\\n' +\n              'Mac 정보 : ' + window.AquaAxPlugin.DeviceMac + '\\n' +\n              'OS 정보 : ' + window.AquaAxPlugin.DeviceOSDesc + '\\n' +\n              '해상도 정보 : ' + window.AquaAxPlugin.DeviceMonitor + '\\n' +\n              'IE 버전 : ' + window.AquaAxPlugin.DeviceIE + '\\n'\n            );\n          }\n        }\n      });\n\n      window.onunload = function () {\n        if (setAxPlugin === true) window.AquaAxPlugin.FinalizeAuth();\n      };\n    },\n    // encparam 을 서버에서 생성하여 전달받는다.\n    getEncodedParam: function () {\n      window.axios.get('/api/v1/player/encparam')\n        .then(function (res) {\n          encodedParam = res.data.encparam;\n          self.reportMessage(encodedParam);\n          self.initPlayer();\n        })\n        .catch(function (err) {\n          self.reportError(err);\n        }\n      );\n    },\n    reportMessage: function (msg) {\n      console.log('aquaservice : ' + msg);\n    },\n    reportError: function (err) {\n      console.log('aquaservice : ' + err);\n    },\n    resize: function () {\n      $(window).resize(function () {\n        if (window.player && !window.player.getFullscreen()) {\n          $('#video').height($(window).height());\n        } else {\n          $('#video').height($(window).height() - $('.wrapper_foot').height());\n        }\n      });\n    },\n    testWatermark () {\n      window.player.setWatermarkText('Watermark');\n      window.player.setWatermarkSize(15);\n      window.player.setWatermarkColor(255, 0, 0, 0.5);\n      window.player.setWatermarkInterval(5);\n      window.player.setWatermarkLocation(22);\n    },\n    testSubtitle: function () {\n      self.testSubtitle1();\n    },\n    testSubtitle1: function () {\n      window.setTimeout(function () {\n        window.player.setSubtitleFont('궁서', 25);\n        window.player.setSubtitleColor(255, 0, 0, 0.5);\n        window.player.setSubtitlePosition(100, 100);\n        window.player.setSubtitleText('Hello, World - 테스트 1');\n        self.testSubtitle2();\n      }, 1000);\n    },\n    testSubtitle2: function () {\n      window.setTimeout(function () {\n        window.player.setSubtitleFont('Malgun Gothic', 15);\n        window.player.setSubtitleColor(0, 255, 0, 1);\n        window.player.setSubtitlePosition(200, 50);\n        window.player.setSubtitleText('Hello, World - 테스트 2');\n        self.testSubtitle3();\n      }, 1000);\n    },\n    testSubtitle3 () {\n      window.setTimeout(function () {\n        window.player.setSubtitleFont('굴림', 35);\n        window.player.setSubtitleColor(0, 0, 255, 0.7);\n        window.player.setSubtitlePosition(50, 200);\n        window.player.setSubtitleText('Hello, World - 테스트 3');\n        self.testSubtitle1();\n      }, 1000);\n    }\n  };\n\n  return AquaPlayerService;\n});\n"],"sourceRoot":"/source/"}