{"version":3,"sources":["components/aquaplayer_service.js"],"names":["window","define","AquaPlayerService","options","extend","self","encodedParam","init","$","a","b","key","hasOwnProperty","extendOptions","getEncodedParam","resize","this","initPlayer","initPlayerHTML","controlBox","player","NPlayer","mode","initNPlayerUI","bindEvent","mygentAuthCall","setPlayerStart","genkey","fileUrl","url","getMediaURL","open","encodeURI","state","indicateUpdate","starthtml5State","reportMessage","OpenState","Opened","setVisible","Closed","PlayState","Playing","Stopped","Paused","name","desc","ec","visible","initPlayerWindow","setAxPlugin","setWatermarkText","setCDNAuthParam","loadAquaAxPlugin","addContextMenu","URL","fileURL","Subtitles","setAquaAxPlugin","isDup","AquaAxPlugin","OpenStateChange","SendPVLog","LoadSystemInfomation","val","onunload","DeviceCPU","DeviceMem","DeviceGPU","DeviceIP","DeviceMac","data","encparam","DeviceOSDesc","DeviceMonitor","DeviceIE","console","FinalizeAuth","then","height","catch","err","reportError","msg","log","getFullscreen"],"mappings":"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","file":"components/aquaplayer_service.js","sourcesContent":["'use strict';\nwindow.define([\n  'common',\n  'text!../../../nplayer_wrapper.html',\n  'nplayer',\n  'nplayer_ui',\n  'cdnproxy',\n  'nplayer_conf'\n], function (Util, NplayerWrapperTemplate) {\n  var self = null;\n  var encodedParam;\n  var player;\n  var $ = $ || window.$;\n\n  function AquaPlayerService (options) {\n    self = this;\n\n    self.extendOptions(options);\n    self.init();\n  }\n\n  AquaPlayerService.prototype = {\n    // 옵션 저장 변수\n    options: {},\n    extend: function (a, b) {\n      for (var key in b) {\n        if (b.hasOwnProperty(key)) {\n          a[key] = b[key];\n        }\n      }\n      return a;\n    },\n    // 옵션 확장\n    extendOptions: function (options) {\n      this.options = this.extend({}, this.options);\n      this.extend(this.options, options);\n    },\n    // 컴포넌트 초기화\n    init: function () {\n      self.getEncodedParam();\n      self.resize();\n      // self.options.container.html(NplayerWrapperTemplate);\n      // window.$('#video').height(window.$(window).height() - window.$('.wrapper_foot').height());\n    },\n    initPlayer: function () {\n      if ('ActiveXObject' in window) {\n        self.initPlayerWindow();\n      } else {\n        self.initPlayerHTML();\n      }\n    },\n    // Player 초기화\n    initPlayerHTML: function () {\n      player = new window.NPlayer('video', {\n        controlBox: 'nplayer_control.html',\n        visible: false,\n        mode: 'html5'\n      });\n\n      // player.setWatermarkText('watermark');\n\n      window.player = player;\n\n      window.initNPlayerUI(player);\n\n      player.bindEvent('Ready', function () {\n        self.reportMessage('ready');\n\n        window.proxy_init(function () {\n          // 1. video start set\n          window.setPlayerStart(true);\n          // 2. nplayer instance set\n          window.setNPlayer(player);\n          // 4. media info set\n          window.mygentAuthCall(function (genkey) {\n            window.setMediaInfo(self.options.fileUrl, genkey);\n\n            var url = window.getMediaURL(false);\n            player.open({\n              'URL': window.encodeURI(url)\n            });\n          }, encodedParam);\n        }, window.indicateInstall, window.indicateUpdate);\n      });\n\n      player.bindEvent('OpenStateChanged', function (state) {\n        self.reportMessage('OpenStateChanged');\n\n        switch (state) {\n        case window.NPlayer.OpenState.Opened:\n          player.setVisible(true);\n          window.starthtml5State();\n          break;\n        case window.NPlayer.OpenState.Closed:\n          window.Stophtml5State(window.NPlayer.OpenState.Closed);\n          break;\n        }\n      });\n\n      player.bindEvent('PlayStateChanged', function (state) {\n        self.reportMessage('PlayStateChanged');\n\n        switch (state) {\n        case window.NPlayer.PlayState.Playing:\n          player.setVisible(true);\n          break;\n\n        case window.NPlayer.PlayState.Stopped:\n          player.setVisible(false);\n          break;\n\n        case window.NPlayer.PlayState.Paused:\n          player.setVisible(true);\n          break;\n        }\n      });\n\n      player.bindEvent('GuardCallback', function (name, desc) {\n        self.reportMessage('GuardCallback - ' + name + ' : ' + desc);\n      });\n\n      player.bindEvent('Error', function (ec) {\n        self.reportMessage('Error - ' + ec);\n      });\n    },\n    initPlayerWindow: function () {\n      player = new window.NPlayer('video', {\n        controlBox: 'nplayer_control.html',\n        visible: false,\n        mode: 'html5'\n      });\n      var setAxPlugin = false;\n\n      player.setWatermarkText('watermark');\n\n      window.player = player;\n\n      window.initNPlayerUI(player);\n\n      player.bindEvent('Ready', function () {\n        self.reportMessage('Ready');\n\n        if (window.loadAquaAxPlugin()) {\n          player.setCDNAuthParam(encodedParam);\n          player.addContextMenu('SystemInfo', 'sysinfo');\n\n          player.open({\n            'URL': encodeURI(self.options.fileURL),\n            'Subtitles': [{\n              'URL': encodeURI('')\n            }]\n          });\n          setAxPlugin = window.setAquaAxPlugin(self.options.fileURL, encodedParam);\n        }\n      });\n\n      player.bindEvent('OpenStateChanged', function (state) {\n        self.reportMessage('OpenStateChanged');\n\n        switch (state) {\n        case window.NPlayer.OpenState.Opened:\n          player.setVisible(true);\n          break;\n        case window.NPlayer.OpenState.Closed:\n          break;\n        }\n      });\n\n      player.bindEvent('PlayStateChanged', function (state) {\n        self.reportMessage('PlayStateChanged');\n\n        switch (state) {\n        case window.NPlayer.PlayState.Playing:\n          player.setVisible(true);\n\n          if (window.isDup === true) {\n            player.stop();\n            window.alert(window.NPLAYER_DUP_MSG);\n            break;\n          }\n\n          if (window.setAxPlugin === true) {\n            window.AquaAxPlugin.PlayState = window.NPlayer.PlayState.Playing;\n            window.AquaAxPlugin.OpenStateChange();\n          }\n          break;\n\n        case window.NPlayer.PlayState.Stopped:\n          player.setVisible(false);\n          break;\n\n        case window.NPlayer.PlayState.Paused:\n          player.setVisible(true);\n\n          if (window.setAxPlugin === true) {\n            window.AquaAxPlugin.PlayState = window.NPlayer.PlayState.Paused;\n            window.AquaAxPlugin.OpenStateChange();\n          }\n          break;\n        }\n      });\n\n      player.bindEvent('GuardCallback', function (name, desc) {\n        if (window.setAxPlugin === true) window.AquaAxPlugin.SendPVLog(name, desc);\n      });\n\n      player.bindEvent('Error', function (ec) {\n        $('#video').css('background-image', 'none');\n      });\n\n      player.bindEvent('ContextMenu', function (val) {\n        if (val === 'sysinfo') {\n          if (window.setAxPlugin === true) {\n            window.AquaAxPlugin.LoadSystemInfomation();\n            window.alert(\n              'CPU 정보 : ' + window.AquaAxPlugin.DeviceCPU + '\\n' +\n              'MEM 정보 : ' + window.AquaAxPlugin.DeviceMem + '\\n' +\n              'GPU 정보 : ' + window.AquaAxPlugin.DeviceGPU + '\\n\\n' +\n              'IP 정보 : ' + window.AquaAxPlugin.DeviceIP + '\\n' +\n              'Mac 정보 : ' + window.AquaAxPlugin.DeviceMac + '\\n' +\n              'OS 정보 : ' + window.AquaAxPlugin.DeviceOSDesc + '\\n' +\n              '해상도 정보 : ' + window.AquaAxPlugin.DeviceMonitor + '\\n' +\n              'IE 버전 : ' + window.AquaAxPlugin.DeviceIE + '\\n'\n            );\n          }\n        }\n      });\n\n      window.onunload = function () {\n        if (window.setAxPlugin === true) window.AquaAxPlugin.FinalizeAuth();\n      };\n    },\n    // encparam 을 서버에서 생성하여 전달받는다.\n    getEncodedParam: function () {\n      window.axios.get('/api/v1/player/encparam')\n        .then(function (res) {\n          encodedParam = res.data.encparam;\n          self.reportMessage(encodedParam);\n          self.initPlayer();\n        })\n        .catch(function (err) {\n          self.reportError(err);\n        }\n      );\n    },\n    reportMessage: function (msg) {\n      console.log('aquaservice : ' + msg);\n    },\n    reportError: function (err) {\n      console.log('aquaservice : ' + err);\n    },\n    resize: function () {\n      $(window).resize(function () {\n        if (player && !!player.getFullscreen()) {\n          $('#video').height($(window).height());\n        } else {\n          $('#video').height($(window).height() - $('.wrapper_foot').height());\n        }\n      });\n    }\n  };\n\n  return AquaPlayerService;\n});\n"],"sourceRoot":"/source/"}