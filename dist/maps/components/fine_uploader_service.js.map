{"version":3,"sources":["components/fine_uploader_service.js"],"names":["window","define","FineUploaderService","self","init","options","this","prototype","uploader","b","a","extend","key","hasOwnProperty","extendOptions","getUploadInfo","axios","response","data","uploadInfo","setFineUploader","uploadUrl","replace","uploadCancelUrl","token","multiple","cors","append","qqTemplate","allowXdr","qq","FineUploader","expected","getElementById","el","autoUpload","validation","mutiple","allowedExtensions","itemLimit","stopOnFirstInvalidFile","request","endpoint","inputName","paramsInBody","folder","target_path","params","callbacks","onComplete","document","id","name","responseJSON","attach","$","$messages","button","FineUploaderBasic","onSubmit","fileName","onProgress","onUpload","progress","Math","round","addClass","removeClass","html","total","success","uploadStoredFiles","error","debug"],"mappings":"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","file":"components/fine_uploader_service.js","sourcesContent":["'use strict';\n\nwindow.define([\n  'jquery',\n  'axios',\n  'fineUploader', // fineUploaderCore\n  'text!../../fine_uploader.html'\n], function ($, axios, qq, qqTemplate) {\n  var self;\n  var uploader;\n\n  function FineUploaderService (options) {\n    self = this;\n\n    self.extendOptions(options);\n    self.init();\n  }\n\n  FineUploaderService.prototype = {\n    // 옵션 저장 변수\n    options: {},\n    extend: function (a, b) {\n      for (var key in b) {\n        if (b.hasOwnProperty(key)) {\n          a[key] = b[key];\n        }\n      }\n      return a;\n    },\n    // 옵션 확장\n    extendOptions: function (options) {\n      this.options = this.extend({}, this.options);\n      this.extend(this.options, options);\n    },\n    // 컴포넌트 초기화\n    init: function () {\n      self.getUploadInfo();\n    },\n    getUploadInfo: function () {\n      axios.get('/api/v1/fineuploader/token')\n      .then(function (response) {\n        var data = response.data.uploadInfo;\n        if (data) {\n          self.options.uploadUrl = data.uploadUrl.replace('v4', 'cdnovp');\n          self.options.uploadCancelUrl = data.uploadCancelUrl;\n          self.options.token = data.token;\n\n          // self.setFineUploaderBasic();\n          self.setFineUploader();\n        }\n      });\n    },\n    setFineUploader: function () {\n      $('#uploader-template').append(qqTemplate);\n      uploader = new qq.FineUploader({\n        element: document.getElementById(self.options.el),\n        autoUpload: false,\n        multiple: self.options.mutiple,\n        cors: {\n          allowXdr: true,\n          expected: true\n        },\n        validation: {\n          allowedExtensions: ['avi', 'mp4'],\n          itemLimit: 3,\n          stopOnFirstInvalidFile: true\n        },\n        request: {\n          endpoint: self.options.uploadUrl,\n          inputName: 'videofile',\n          paramsInBody: false,\n          params: {\n            token: self.options.token,\n            folder: '/dev',\n            target_path: '/dev'\n          }\n        },\n        callbacks: {\n          onComplete: function (id, name, responseJSON, xhr) {\n            // console.log(responseJSON);\n          }\n        }\n      });\n      qq(document.getElementById('upload-button')).attach('click', function () {\n        uploader.uploadStoredFiles();\n      });\n    },\n    setFineUploaderBasic: function () {\n      var $fub = $('#fine-uploader-basic');\n      var $messages = $('#messages');\n\n      uploader = new qq.FineUploaderBasic({\n        button: $fub[0],\n        autoUpload: false,\n        multiple: self.options.mutiple,\n        cors: {\n          allowXdr: true,\n          expected: true\n        },\n        validation: {\n          allowedExtensions: ['avi', 'mp4'],\n          itemLimit: 3,\n          stopOnFirstInvalidFile: true\n        },\n        request: {\n          endpoint: self.options.uploadUrl,\n          inputName: 'videofile',\n          paramsInBody: false,\n          params: {\n            token: self.options.token,\n            folder: '/dev',\n            target_path: '/dev'\n          }\n        },\n        callbacks: {\n          onSubmit: function (id, fileName) {\n            $messages.append('<div id=\"file-' + id + '\" class=\"alert\" style=\"margin: 20px 0 0\"></div>');\n          },\n          onUpload: function (id, fileName) {\n            $('#file-' + id).addClass('alert-info')\n              .html('<img src=\"/static/stylesheets/images/loading.gif\" alt=\"Initializing. Please hold.\"> ' +\n                    'Initializing ' +\n                    '“' + fileName + '”');\n          },\n          onProgress: function (id, fileName, loaded, total) {\n            if (loaded < total) {\n              var progress = Math.round(loaded / total * 100) + '% of ' + Math.round(total / 1024) + ' kB';\n              $('#file-' + id).removeClass('alert-info')\n                .html('<img src=\"/static/stylesheets/images/loading.gif\" alt=\"In progress. Please hold.\"> ' +\n                  'Uploading ' +\n                  '“' + fileName + '” ' +\n                  progress);\n            } else {\n              $('#file-' + id).addClass('alert-info')\n                .html('<img src=\"/static/stylesheets/images/loading.gif\" alt=\"Saving. Please hold.\"> ' +\n                      'Saving ' +\n                      '“' + fileName + '”');\n            }\n          },\n          onComplete: function (id, fileName, responseJSON) {\n            if (responseJSON.success) {\n              $('#file-' + id).removeClass('alert-info')\n                .addClass('alert-success')\n                .html('<i class=\"icon-ok\"></i> ' +\n                      'Successfully saved ' +\n                      '“' + fileName + '”' +\n                      '<br><img src=\"img/success.jpg\" alt=\"' + fileName + '\">');\n            } else {\n              $('#file-' + id).removeClass('alert-info')\n                .addClass('alert-error')\n                .html('<i class=\"icon-exclamation-sign\"></i> ' +\n                      'Error with ' +\n                      '“' + fileName + '”: ' +\n                      responseJSON.error);\n            }\n          }\n        },\n        debug: true\n      });\n\n      qq(document.getElementById('upload-button')).attach('click', function () {\n        uploader.uploadStoredFiles();\n      });\n    }\n  };\n\n  return FineUploaderService;\n});\n"],"sourceRoot":"/source/"}