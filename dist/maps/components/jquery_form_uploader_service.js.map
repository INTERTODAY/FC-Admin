{"version":3,"sources":["components/jquery_form_uploader_service.js"],"names":["window","define","Util","self","JqueryFormUploaderService","options","this","init","$","uploadedFileName","axios","XHR","XMLHttpRequest","percent","status","percentVal","prototype","extend","b","hasOwnProperty","key","a","extendOptions","on","validate","attr","getUploadInfo","e","cancelUpload","data","then","response","uploadUrl","uploadInfo","token","replace","uploadCancelUrl","send","val","bar","width","html","alert","clearForm","error","console","log","get","files","length","formData","makeid","getExtension","fileToUpload","name","append","url","contentType","processData","cache","beforeSend","empty","xhr","upload","addEventListener","lengthComputable","Math","floor","loaded","total","success","responseText","errorInfo","errorCode","videoName","callback","errorMessage","send2"],"mappings":"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","file":"components/jquery_form_uploader_service.js","sourcesContent":["'use strict';\n\nwindow.define([\n  'common'\n  // 'jquery-form'\n], function (Util) {\n  var self;\n  var $ = $ || window.$;\n  var axios = axios || window.axios;\n  var XHR = new window.XMLHttpRequest();\n  var uploadedFileName;\n\n  var bar = $('.fileuploader-bar');\n  var percent = $('.fileuploader-percent');\n  var status = $('#status');\n  var percentVal = '0%';\n\n  function JqueryFormUploaderService (options) {\n    self = this;\n\n    self.extendOptions(options);\n    self.init();\n  }\n\n  JqueryFormUploaderService.prototype = {\n    // 옵션 저장 변수\n    options: {},\n    extend: function (a, b) {\n      for (var key in b) {\n        if (b.hasOwnProperty(key)) {\n          a[key] = b[key];\n        }\n      }\n      return a;\n    },\n    // 옵션 확장\n    extendOptions: function (options) {\n      this.options = this.extend({}, this.options);\n      this.extend(this.options, options);\n    },\n    // 컴포넌트 초기화\n    init: function () {\n      $('#cancel-button').attr('disabled', true);\n      $('#upload-button').on('click', function () {\n        if (!self.validate()) return false;\n\n        $('#upload-button').attr('disabled', true);\n        $('#cancel-button').attr('disabled', false);\n\n        self.getUploadInfo();\n      });\n      $('#cancel-button').on('click', function (e) {\n        XHR.abort();\n        self.cancelUpload();\n      });\n    },\n    // 업로드 정보를 요청한다.\n    getUploadInfo: function () {\n      axios.get('/api/v1/fineuploader/token')\n      .then(function (response) {\n        var data = response.data.uploadInfo;\n        if (data) {\n          self.options.uploadUrl = data.uploadUrl.replace('v4', 'cdnovp');\n          self.options.uploadCancelUrl = data.uploadCancelUrl;\n          self.options.token = data.token;\n\n          // 업로드 한다.\n          self.send();\n        }\n      });\n    },\n    clearForm: function () {\n      $('#upload-button').attr('disabled', false);\n      $('#cancel-button').attr('disabled', true);\n      $('#fileupload').val('');\n\n      percentVal = '0%';\n      bar.width(percentVal);\n      percent.html(percentVal);\n    },\n    // 업로드를 취소한다.\n    cancelUpload: function () {\n      axios.post(self.options.uploadCancelUrl + '?token=' + self.options.token, {\n        token: self.options.token\n      })\n      .then(function (response) {\n        window.alert('업로드 취소');\n\n        self.clearForm();\n      })\n      .catch(function (error) {\n        console.log(error);\n      });\n    },\n    validate: function () {\n      if ($('#fileupload').get(0).files.length === 0) {\n        window.alert('파일을 선택하세요.');\n        return false;\n      }\n\n      return true;\n    },\n    // 파일 업로드\n    // ref: https://stackoverflow.com/questions/166221/how-can-i-upload-files-asynchronously\n    send: function () {\n      var formData = new window.FormData();\n      var fileToUpload = $('#fileupload').get(0).files[0];\n      uploadedFileName = Util.makeid() + '.' + Util.getExtension(fileToUpload.name);\n\n      formData.append('token', self.options.token);\n      formData.append('folder', 2004661);\n      formData.append('pkg', 1006241);\n      formData.append('target_path', self.options.uploadFolder);\n      formData.append('videofile', fileToUpload, uploadedFileName);\n\n      $.ajax({\n        url: self.options.uploadUrl + '?token=' + self.options.token,\n        data: formData,\n        type: 'post',\n        contentType: false,\n        processData: false,\n        cache: false,\n        beforeSend: function () {\n          status.empty();\n          percentVal = '0%';\n          bar.width(percentVal);\n          percent.html(percentVal);\n        },\n        xhr: function () {\n          if (XHR.upload) {\n            XHR.upload.addEventListener('progress', function (e) {\n              if (e.lengthComputable) {\n                percentVal = Math.floor(e.loaded / e.total * 100) + '%';\n                bar.width(percentVal);\n                percent.html(percentVal);\n              }\n            }, false);\n          }\n          return XHR;\n        },\n        success: function (responseText) {\n          var data = JSON.parse(responseText);\n\n          console.log(data);\n\n          if (data.uploadInfo.errorInfo.errorCode === 'None') {\n            percentVal = '100%';\n            bar.width(percentVal);\n            percent.html(percentVal);\n\n            window.alert('업로드 성공');\n\n            self.clearForm();\n\n            $('#aqua-video-code').val('onm_' + uploadedFileName);\n            $('#fineUploader').modal('hide');\n\n            self.options.callback({\n              success: true,\n              videoName: uploadedFileName\n            });\n          } else {\n            window.alert(data.uploadInfo.errorInfo.errorMessage);\n          }\n\n          $('#upload-button').attr('disabled', false);\n          $('#cancel-button').attr('disabled', true);\n        }\n      });\n    },\n    send2: function () {\n      // var bar = $('.bar');\n      // var percent = $('.percent');\n      // var status = $('#status');\n      // var options = {\n      //   url: self.options.uploadUrl + '?token=' + self.options.token,\n      //   type: 'post',\n      //   dataType: 'json',\n      //   clearForm: true,\n      //   resetForm: true,\n      //   target: '#fileupload-form',\n      //   data: {\n      //     token: self.options.token,\n      //     folder: 2004661,\n      //     pkg: 1006241,\n      //     target_path: self.options.uploadFolder\n      //   },\n      //   // timeout: 3000,\n      //   beforeSerialize: function ($form, options) {\n      //     console.log($form);\n      //     console.log(options);\n      //     return true;\n      //   },\n      //   beforeSumbit: function (formData, jqForm, options) {\n      //     console.log(formData);\n      //     formData.set('videofile', $('#fileupload').get(0).files[0], '123.mp4');\n      //     return true;\n      //   },\n      //   beforeSend: function () {\n      //     status.empty();\n      //     var percentVal = '0%';\n      //     bar.width(percentVal);\n      //     percent.html(percentVal);\n      //   },\n      //   uploadProgress: function (event, position, total, percentComplete) {\n      //     var percentVal = percentComplete + '%';\n      //     bar.width(percentVal);\n      //     percent.html(percentVal);\n      //   },\n      //   success: function (responseText, statusText, xhr, $form) {\n      //     console.log(responseText);\n      //     var percentVal = '100%';\n      //     bar.width(percentVal);\n      //     percent.html(percentVal);\n      //   },\n      //   complete: function (xhr) {\n      //     status.html(xhr.responseText);\n      //   }\n      // };\n\n      // $('#fileupload-form').ajaxForm(options);\n    }\n  };\n\n  return JqueryFormUploaderService;\n});\n"],"sourceRoot":"/source/"}