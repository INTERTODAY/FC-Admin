{"version":3,"sources":["winpops/win_create_video.js"],"names":["window","requirejs","btnUploadVideo","$","videoTitle","val","focus","$videoCode","videoProvider","video_code","video_provider","video_player","html","btnPlayVideo","$setAquaPlayer","$setVimeoPlayer","$aquaPlayerFrame","tableVideos","initDataTable","btnApplyVideo","Util","buttons","data","e","preventDefault","videoInfo","confirm","rows","search","modal","url","attr","getOSName","id","option","addClass","this","removeClass","options","on","FineUploaderService","el","multiple","bind","which","keyCode","displayVideo","btnRegistVideo","validateForm","videoCode","axios","post","course_id","video_name","then","response","alert","parent","opener","winpop_listener","close","console","error","log","onbeforeunload","event"],"mappings":"AAAA,YAEAA,QAAOC,WAML,SACA,QACA,uBAEA,SAAIC,EAAAA,EAAiBC,GAyJnB,QAAIC,KAAJ,GAAIA,GAAaD,EAAE,eAGjBH,KAAAA,EAAaK,MAGd,MAFCD,QAAAA,MAAWE,mBACXF,EAAOE,SACR,CAGD,IAAIC,GAAAA,EAAJJ,EAAA,mBAAAE,KASEL,OANe,UAAfO,EADFA,EAEWC,EAAAA,qBACM,SAAfD,IACDA,EAAAJ,EAAA,uBAGCH,EAAaK,QACbE,OAAAA,MAAWD,kBACXC,EAAOD,SACR,GASD,QAAIG,KACJ,GAAIC,GAAAA,EAAAA,qBAAiBL,MACjBM,EAAiBR,EAAA,mBAArBE,MAAIM,EAAeR,EAAE,gBAEF,KAAAM,EAAA,OAAA,CAEnB,QAAQC,GAAR,IAAA,UACAC,EAAKC,KAAL,wEAAAH,EAAA,6CAGE,MACF,KAAA,QACEE,EAAAA,KAAaC,+CAAKH,EAAA,gJAlMtB,GAAII,GAAAA,GAAAA,OAAeV,EAGfW,EAAiBX,EAAE,iBACnBY,EAAAA,EAAkBZ,gBAClBa,EAAAA,EAAAA,eAEAC,EAAmBC,EAAAA,mBACnBC,EAAgBhB,EAAE,wBAJlBY,EAAkBZ,EAAE,mBAMxBH,EAAqBG,EAAA,qBAEnBc,EAAAG,EAAAF,cAAAf,EAAA,qBAAAkB,aACAF,EAAAhB,EAAA,iBAEAH,QAAAG,EAAA,cAM0DgB,EAE9CG,KAFI,QAAhB,SAAAC,GAFAA,EAAEC,gBAOA,IAAAC,GAAWC,EAAAA,sBAAsBT,EAAAU,MAC/BC,OAAA,YACAzB,SAAEmB,WAEFN,KAAAA,EACDhB,OAAA0B,QAAA,eAED1B,EAAAA,aAAa6B,MAAA,QACd1B,EAAA,oBAAAE,IAAAoB,EAAAK,KAhBHd,EAAAe,KAAA,MAAA,mBAAAX,EAAAY,YAAA,aAAAP,EAAAQ,KAoBEjC,OAAIkC,MAAW,iBAIbpB,EAAeqB,GAAAA,SAAS,WACxBhC,GAAE+B,GAAA/B,EAAAiC,MAAF/B,KAEAS,WAAAA,GACAC,EAAgBoB,YAAS,SACzBhC,EAAEgC,SAAkBE,SACrBlC,EAAA,kBAAAgC,SAAA,UAXH,SAAAD,IAQIpB,EAAeuB,YAAY,SAM/BnC,EAAkBiC,SAAS,SACzBhC,EAAImC,kBAAUD,YAAA,YADhBnC,EAAeqC,GAAG,QAAS,WAMzBC,EAAsB,GAAIA,IAN5BC,GAAA,cAGIC,UAAU,MAqCJvC,EAAA,qBAAAwC,KAAA,WAAA,SAAApB,GADI,MAFdA,EAAAqB,OAAArB,EAAAsB,UAEoBC,MAOnBjC,EAHD8B,KAAA,QAAA,SAAApB,GACEuB,MAOAC,EAAKC,KAAAA,QAAgB,SAAAzB,GACrB,GADuBA,EAAAC,kBAClBxB,IAAe,OAAA,CAAgB,KAAAA,OAAO0B,QAAP,aAAA,OAAA,CAEpC,IAAIlB,GAAAA,EAAgBL,EAAE,mBAAmBE,KAGnB,WAAlBG,EAAJyC,EAAIzC,EAAAA,kCAA2BH,MACf,SAAd4C,IADFA,EAEWzC,EAAAA,iCAA0BH,OAIrCL,OAAOkD,MAAMC,KAAK,wBAAlBnD,UAAamD,EAAAA,2BAA6B9C,MACxC+C,WAAWjD,EAAE,4BAA6BE,MAC1CgD,eAAc7C,EACdE,WAAAA,IAGC4C,KAAK,SAAUC,GACdvD,OAAOwD,MAAM,iBACbxD,OAAOyD,OAAOC,OAAOC,iBAAgB,GACrC3D,OAAO4D,UAGPC,MAAAA,SAAAC,GAZJ,MAaID,SAAOE,IAAPD,IAbJ,MA8FA9D,OAAAgE,eAAA,SAAAC","file":"winpops/win_create_video.js","sourcesContent":["'use strict';\n\nwindow.requirejs([\n  'common',\n  'Vimeo',\n  'fineUploaderService'\n],\nfunction (Util, Vimeo, FineUploaderService) {\n  var $ = $ || window.$;\n  var player = null;\n  // var playerContainer = $('#videoplayer');\n  var btnRegistVideo = $('#regist-video');\n  var btnUploadVideo = $('#uploadVideo');\n  var btnPlayVideo = $('#play-video');\n  // var _confirm = true; // 윈도우 종료 시 창을 닫을지 여부\n  var $selectVideoProvider = $('#video-provider');\n  var $setAquaPlayer = $('.aquaplayer-settings');\n  var $setVimeoPlayer = $('.vimeo-settings');\n  var $aquaPlayerFrame = $('#aquaplayer_frame');\n  // datatable 설정\n  var tableVideos = Util.initDataTable($('#table_add_video'), { buttons: [] });\n  var btnApplyVideo = $('#btnApplyVideo');\n\n  window.$(function () {\n    // console.log('hello!');\n    // window.alert(window.parent.opener);\n    // window.parent.opener.winpop_listener();\n\n    // $aquaPlayerFrame.attr('src', '/api/v1/aqua?os=' + Util.getOSName() + '&video_id=148');\n  });\n\n  btnApplyVideo.bind('click', function (e) {\n    e.preventDefault();\n\n    var videoInfo = $('input:first:checked', tableVideos.rows({\n      search: 'applied'\n    }).nodes()).data();\n\n    if (videoInfo !== undefined) {\n      if (window.confirm('적용하시겠습니까?')) {\n        // 모달창 종료\n        $('#addVideo').modal('hide');\n        $('#aqua-video-code').val(videoInfo.url);\n        $aquaPlayerFrame.attr('src', '/api/v1/aqua?os=' + Util.getOSName() + '&video_id=' + videoInfo.id);\n      }\n    } else {\n      window.alert('비디오를 선택하세요.');\n    }\n  });\n\n  $selectVideoProvider.on('change', function () {\n    var option = $(this).val();\n\n    if (option === 'VIMEO') {\n      $setVimeoPlayer.removeClass('blind');\n      $setAquaPlayer.addClass('blind');\n      $('.video-preview').addClass('blind');\n    } else if (option === 'AQUA') {\n      $setAquaPlayer.removeClass('blind');\n      $setVimeoPlayer.addClass('blind');\n      $('.video-preview').removeClass('blind');\n    }\n  });\n\n  btnUploadVideo.on('click', function () {\n    var options = {\n      el: 'my-uploader',\n      multiple: false\n    };\n\n    FineUploaderService = new FineUploaderService(options);\n  });\n\n  /**\n   * Player 를 초기화 한다.\n   */\n  function initPlayer () {\n    var videoUrl = $('#vimeo-video-code').val();\n    var options = {\n      url: videoUrl,\n      loop: false\n    };\n\n    if (player) {\n      player.unload().then(function () {\n        console.info(player);\n        player.loadVideo('157991194');\n      }).catch(function (error) {\n        console.log('비메오 오류발생!');\n        console.error(error);\n      });\n    } else {\n      player = new Vimeo('videoplayer', options);\n      player.setVolume(0.5);\n      player.on('error', function (data) {\n        console.log('비메오 오류발생!');\n        console.error(data);\n      });\n    }\n  }\n\n  $('#vimeo-video-code').bind('keypress', function (e) {\n    var key = e.which || e.keyCode;\n    if (key === 13) { displayVideo(); }\n            // initPlayer();\n  });\n\n  btnPlayVideo.bind('click', function (e) {\n    displayVideo();\n        // initPlayer();\n  });\n\n  btnRegistVideo.bind('click', function (e) {\n    e.preventDefault();\n\n    if (!validateForm()) { return false; }\n    if (!window.confirm('저장하시겠습니까?')) { return false; }\n\n    var videoProvider = $('#video-provider').val();\n    var videoCode;\n\n    if (videoProvider === 'VIMEO') {\n      videoCode = $('input[name=\\'vimeo-video-code\\']').val();\n    } else if (videoProvider === 'AQUA') {\n      videoCode = $('input[name=\\'aqua_video_code\\']').val();\n    }\n\n    window.axios.post('/course/create/video', {\n      course_id: $('input[name=\\'course_id\\']').val(),\n      video_name: $('input[name=\\'video_name\\']').val(),\n      video_provider: videoProvider,\n      video_code: videoCode\n    })\n      .then(function (response) {\n        window.alert('비디오를 저장하였습니다.');\n        window.parent.opener.winpop_listener(true);\n        window.close();\n      })\n      .catch(function (error) {\n        console.log(error);\n        return false;\n      });\n\n    // var params = $('form').serialize();\n    // $.ajax({\n    //   url: $('form').attr('action'),\n    //   type: 'POST',\n    //   data: params,\n    //   contentType: 'application/x-www-form-urlencoded; charset=UTF-8',\n    //   dataType: 'html',\n    //   success: function (response) {\n    //     window.alert('비디오를 저장하였습니다.');\n    //     // window.parent.opener.location.reload(); // 부모폼을 reload 한다.\n    //     window.parent.opener.winpop_listener(true);\n\n    //     // _confirm = false;\n    //     window.close();\n    //   }\n    // });\n  });\n\n    /**\n     * 폼 validate\n     */\n  function validateForm () {\n    var videoTitle = $('#video-title');\n\n    if (!videoTitle.val()) {\n      window.alert('비디오 강좌명을 입력하세요.');\n      videoTitle.focus();\n      return false;\n    }\n\n    var videoProvider = $('#video-provider').val();\n    var $videoCode;\n\n    if (videoProvider === 'VIMEO') {\n      $videoCode = $('#vimeo-video-code');\n    } else if (videoProvider === 'AQUA') {\n      $videoCode = $('#aqua-video-code');\n    }\n\n    if (!$videoCode.val()) {\n      window.alert('비디오 코드를 입력하세요.');\n      $videoCode.focus();\n      return false;\n    }\n\n    return true;\n  }\n\n    /**\n     * 비디오를 표시한다.\n     */\n  function displayVideo () {\n    var video_code = $('#vimeo-video-code').val();\n    var video_provider = $('#video-provider').val();\n    var video_player = $('#video-player');\n\n    if (!video_code) { return false; }\n\n    switch (video_provider) {\n    case 'YOUTUBE':\n      video_player.html('<iframe width=\"100%\" height=\"600\" src=\"https://www.youtube.com/embed/' + video_code + '\"' +\n                    'frameborder=\"0\" allowfullscreen></iframe>');\n      break;\n    case 'VIMEO':\n      video_player.html('<iframe src=\"https://player.vimeo.com/video/' + video_code + '\"?title=0&byline=0&portrait=0\" ' +\n                    'width=\"100%\" height=\"600\" frameborder=\"0\" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>');\n      break;\n\n    default:\n      break;\n    }\n  }\n\n    /**\n     * 윈도우 팝업창 종료 시 발생\n     *\n     */\n  window.onbeforeunload = function (event) {\n    // if (_confirm) { return confirm('진행중인 작업이 모두 사라집니다. 계속하시겠습니까?'); }\n  };\n});\n"],"sourceRoot":"/source/"}