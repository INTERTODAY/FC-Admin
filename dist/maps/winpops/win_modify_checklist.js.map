{"version":3,"sources":["winpops/win_modify_checklist.js"],"names":["window","requirejs","btnSaveChecklist","$","tableChecklist","items","placeholder","find","not","focus","handle","sortable","forcePlaceholderSize","zIndex","start","update","e","ui","this","attr","item","index","removeAttr","setRowNo","$row","$itemType","closest","$sample","$item","val","$category","alert","$clone","clone","html","length","hide","show","after","axios","delete","params","checklist_group_id","checklist_id","then","response","data","console","catch","error","$selected","select","which","on","click","parent","$title","trim","rows","i","each","item_section","id","itemId","item_name","item_type","sample","order","push","title","itemArray","course_list_id","closeWindow","row","winpop_listener","opener","close"],"mappings":"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","file":"winpops/win_modify_checklist.js","sourcesContent":["'use strict';\nwindow.requirejs(\n  [\n    'common'\n  ],\nfunction (Util) {\n  // var btnAddItem = window.$('.additem');\n  var tableChecklist = window.$('#table_checklist');\n  var btnSaveChecklist = window.$('#regist-quiz');\n\n  window.$(function () {\n    tableChecklist.find('tr:first-child').not('thead tr').find('input[name=\"item\"]').focus();\n    tableChecklist.find('tbody').sortable({\n      items: 'tr:not(:first)',\n      placeholder: 'sort-highlight',\n      handle: '.handle',\n      forcePlaceholderSize: true,\n      zIndex: 999999,\n      start: function (e, ui) {\n        window.$(this).attr('data-previndex', ui.item.index());\n      },\n      update: function (e, ui) {\n        // var newIndex = ui.item.index();\n        // var oldIndex = window.$(this).attr('data-previndex');\n        window.$(this).removeAttr('data-previndex');\n        setRowNo();\n        // console.log('newIndex : ' + newIndex + ' oldIndex : ' + oldIndex);\n      }\n    });\n  });\n\n  /**\n   * 행추가\n   */\n  tableChecklist.on('click', '.additem', function (e) {\n    var $row = window.$(this).closest('.item');\n    var $category = $row.find('input[name=\"category\"]');\n    var $item = $row.find('input[name=\"item\"]');\n    var $itemType = $row.find('.itemtype');\n    var $sample = $row.find('.sample');\n\n    if ($itemType.val() !== 'write') {\n      if ($category.val() === '') {\n        window.alert('분류를 입력하세요.');\n        $category.focus();\n        return false;\n      }\n    }\n\n    if ($item.val() === '') {\n      window.alert('체크사항을 입력하세요.');\n      $item.focus();\n      return false;\n    }\n\n    var $clone = $row.clone();\n\n    $clone.find('.itemno').html(tableChecklist.find('tr').not(':first').length);\n    $clone.find('#item').attr('placeholder', '');\n    $clone.find('.itemtype').val($itemType.val());\n    $clone.find('.additem').hide();\n    $clone.find('.removeitem').show();\n    tableChecklist.find('tbody').find('tr:last').after($clone);\n\n    $itemType.val('select'); // 선택형\n    $category.show();\n    $sample.show();\n    $item.val('');\n    $item.focus();\n  });\n\n  /**\n   * 행삭제\n   */\n  tableChecklist.on('click', '.removeitem', function () {\n    var $row = window.$(this).closest('.item');\n    if (window.confirm('삭제하시겠습니까?')) {\n      window.axios.delete('/course/checklist', {\n        params: {\n          checklist_group_id: window.$('input[name=checklist_group_id]').val(),\n          checklist_id: $row.data('id')\n        }\n      }).then(function (response) {\n        window.alert('체크리스트를 삭제하였습니다.');\n        $row.remove();\n        setRowNo();\n      })\n      .catch(function (error) {\n        console.error(error);\n      });\n    }\n  });\n\n  tableChecklist.on('change', '.itemtype', function (e) {\n    var $row = window.$(this).closest('.item');\n    var $selected = window.$(this);\n    var $item = $row.find('input[name=\"item\"]');\n    var $category = $row.find('input[name=\"category\"]');\n    var $sample = $row.find('.sample');\n\n    switch ($selected.val()) {\n    case 'write':\n      $category.hide();\n      $sample.hide();\n      break;\n    default:\n      $category.show();\n      $sample.show();\n      break;\n    }\n\n    $item.select();\n  });\n\n  tableChecklist.on('keypress', '.inputitem', function (e) {\n    if (e.which === 13) {\n      var $row = window.$(this).parent().closest('.item');\n      if ($row.index() === 0) {\n        $row.find('.additem').click();\n      }\n    }\n  });\n\n  /**\n   * 자료 저장하기\n   */\n  btnSaveChecklist.on('click', function () {\n    var itemArray = [];\n    var rows = tableChecklist.find('tr').not(':first');\n    var $title = window.$('input[name=title]');\n\n    if ($title.val().trim() === '') {\n      window.alert('대표제목을 입력하세요.');\n      $title.focus();\n      return false;\n    }\n\n    rows.each(function (i, row) {\n      if (i === 0) return true;\n      var $row = window.$(row);\n      var itemId = $row.data('id');\n      var $itemType = $row.find('.itemtype');\n      var $item = $row.find('input[name=\"item\"]');\n      var $category = $row.find('input[name=\"category\"]');\n      var $sample = $row.find('input[name=\"sample\"]');\n\n      // 체크사항 빈값여부 검사\n      if ($item.val() === '') {\n        window.alert('체크사항을 입력하세요.');\n        $item.focus();\n        return false;\n      }\n      // 보기 빈값여부 검사\n      if ($itemType.val() === 'select' || $itemType.val() === 'choose') {\n        if ($sample.val() === '') {\n          window.alert('보기를 입력하세요.');\n          $sample.focus();\n          return false;\n        }\n      }\n\n      itemArray.push({\n        id: itemId,\n        item_name: $item.val(),\n        item_type: $itemType.val(),\n        item_section: (function () {\n          if ($itemType.val() !== 'write') {\n            return $category.val();\n          } else {\n            return '';\n          }\n        }()),\n        sample: (function () {\n          if ($itemType.val() !== 'write') {\n            return $sample.val();\n          } else {\n            return '';\n          }\n        }()),\n        order: i\n      });\n    });\n\n    // console.log(itemArray);\n    window.axios.post('/course/checklist', {\n      course_id: window.$('input[name=course_id]').val(),\n      course_list_id: window.$('input[name=course_list_id]').val(),\n      checklist_group_id: window.$('input[name=checklist_group_id]').val(),\n      title: window.$('input[name=title]').val(),\n      data: itemArray\n    })\n    .then((response) => {\n      // console.log(response);\n      window.alert('자료를 수정하였습니다.');\n      closeWindow();\n    })\n    .catch((error) => {\n      console.error(error);\n    });\n  });\n\n  /**\n   * 번호를 다시 매긴다.\n   */\n  const setRowNo = () => {\n    var rows = tableChecklist.find('tr').not(':first');\n    rows.each(function (i, row) {\n      if (i === 0) return true;\n      var $row = window.$(row);\n      $row.find('.itemno').html(i);\n    });\n  };\n\n  const closeWindow = () => {\n    // window.parent.opener.location.reload();\n    window.parent.opener.winpop_listener();\n    window.close();\n  };\n});\n\n"],"sourceRoot":"/source/"}