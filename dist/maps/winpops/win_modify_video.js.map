{"version":3,"sources":["winpops/win_modify_video.js"],"names":["requirejs","$btnPlayVideo","JqueryFileUploaderService","$setVimeoPlayer","$setAquaPlayer","val","option","removeClass","$","addClass","$btnUploadVideo","videoCode","videoTitle","focus","window","alert","console","$videoPlayer","videoProvider","html","$aquaPlayerFrame","data","attr","Util","getOSName","$selectVideoProvider","tableVideos","initDataTable","$btnChangeVideo","setVideoOptions","displayVideo","e","search","bind","preventDefault","videoInfo","undefined","rows","nodes","modal","url","id","on","options","uploadFolder","keyCode","which","$btnModifyVideo","validateForm","confirm","axios","post","course_id","course_list_id","this","video_name","video_provider","video_code","video_id","response","parent","opener","close","winpop_listener","catch","error","log","onbeforeunload","event","_confirm"],"mappings":"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","file":"winpops/win_modify_video.js","sourcesContent":["'use strict';\n\nrequirejs([\n  'common',\n  'Vimeo',\n  'jqueryUploaderService'\n], function (Util, Vimeo, JqueryFileUploaderService) {\n  var $ = $ || window.$;\n  var $btnModifyVideo = $('#modify-video');\n  var $btnUploadVideo = $('#uploadVideo');\n  var $btnPlayVideo = $('#play-video');\n  var $selectVideoProvider = $('#video-provider');\n  var $setAquaPlayer = $('.aquaplayer-settings');\n  var $setVimeoPlayer = $('.vimeo-settings');\n  var $aquaPlayerFrame = $('#aquaplayer_frame');\n  // datatable 설정\n  var tableVideos = Util.initDataTable($('#table_add_video'), { buttons: [] });\n  var $btnChangeVideo = $('#btnApplyVideo');\n\n  $(function () {\n    setVideoOptions();\n    displayVideo();\n  });\n\n  $btnChangeVideo.bind('click', function (e) {\n    e.preventDefault();\n\n    var videoInfo = $('input:first:checked', tableVideos.rows({\n      search: 'applied'\n    }).nodes()).data();\n\n    if (videoInfo !== undefined) {\n      if (window.confirm('적용하시겠습니까?')) {\n        // 모달창 종료\n        $('#addVideo').modal('hide');\n        $('#aqua-video-code').val(videoInfo.url);\n        $aquaPlayerFrame.attr('src', '/api/v1/aqua?os=' + Util.getOSName() + '&video_id=' + videoInfo.id);\n      }\n    } else {\n      window.alert('비디오를 선택하세요.');\n    }\n  });\n\n  $selectVideoProvider.on('change', function () {\n    setVideoOptions();\n  });\n\n  function setVideoOptions () {\n    var option = $selectVideoProvider.val();\n\n    if (option === 'VIMEO' || option === 'YOUTUBE') {\n      $setVimeoPlayer.removeClass('blind');\n      $setAquaPlayer.addClass('blind');\n      $('.video-preview').addClass('blind');\n    } else if (option === 'AQUA') {\n      $setAquaPlayer.removeClass('blind');\n      $setVimeoPlayer.addClass('blind');\n      $('.video-preview').removeClass('blind');\n    }\n  }\n\n  $btnUploadVideo.on('click', function () {\n    // var options = {\n      // el: 'my-uploader',\n      // multiple: false\n    // };\n\n    // FineUploaderService = new FineUploaderService(options);\n\n    var options = {\n      uploadFolder: $('#upload_folder').val(),\n      callback: function (data) {\n        // $aquaPlayerFrame.attr('src', '/api/v1/aqua?os=' + Util.getOSName() + '&video_id=' + data.id);\n      }\n    };\n    JqueryFileUploaderService = new JqueryFileUploaderService(options);\n  });\n\n  $('#video-code').bind('keypress', function (e) {\n    var key = e.which || e.keyCode;\n    if (key === 13) {\n      displayVideo();\n    }\n  });\n\n  $btnPlayVideo.bind('click', function (e) {\n    displayVideo();\n  });\n\n  $btnModifyVideo.bind('click', function (e) {\n    e.preventDefault();\n\n    if (!validateForm()) { return false; }\n    if (!window.confirm('저장하시겠습니까?')) { return false; }\n\n    var videoProvider = $('#video-provider').val();\n    var videoCode;\n\n    if (videoProvider === 'VIMEO' || videoProvider === 'YOUTUBE') {\n      videoCode = $('input[name=\\'vimeo_video_code\\']').val();\n    } else if (videoProvider === 'AQUA') {\n      videoCode = $('input[name=\\'aqua_video_code\\']').val();\n    }\n\n    window.axios.post('/course/modify/video', {\n      course_id: $('input[name=\\'course_id\\']').val(),\n      course_list_id: $(this).data('course-list-id'),\n      video_name: $('input[name=\\'video_name\\']').val(),\n      video_provider: videoProvider,\n      video_code: videoCode,\n      video_id: $(this).data('video-id')\n    })\n      .then(function (response) {\n        window.alert('비디오를 저장하였습니다.');\n        window.parent.opener.winpop_listener(true);\n        window.close();\n      })\n      .catch(function (error) {\n        console.log(error);\n        return false;\n      });\n\n    // legacy\n\n    // var params = $('form').serializeArray();\n    // params.push({\n    //   name: 'course_list_id',\n    //   value: $(this).data('course-list-id')\n    // });\n    // params.push({\n    //   name: 'video_id',\n    //   value: $(this).data('video-id')\n    // });\n\n    // // console.log(params);\n    // // return false;\n\n    // $.ajax({\n    //   url: $('form').attr('action'),\n    //   type: 'PUT',\n    //   data: params,\n    //   contentType: 'application/x-www-form-urlencoded; charset=UTF-8',\n    //   dataType: 'html',\n    //   success: function (response) {\n    //     alert('비디오를 저장하였습니다.');\n    //     // window.parent.opener.location.reload(); // 부모폼을 reload 한다.\n    //     window.parent.opener.winpop_listener(true);\n    //     _confirm = false;\n    //     window.close();\n    //   }\n    // });\n  });\n\n  /**\n   * 폼 validate\n   */\n  function validateForm () {\n    var videoTitle = $('#video-title');\n    var videoCode = $('#video-code');\n\n    if (!videoTitle.val()) {\n      window.alert('비디오 강좌명을 입력하세요.');\n      videoTitle.focus();\n      return false;\n    }\n    if (!videoCode.val()) {\n      window.alert('비디오 코드를 입력하세요.');\n      videoCode.focus();\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * 비디오를 표시한다.\n   */\n  function displayVideo () {\n    var videoProvider = $('#video-provider').val();\n    var videoCode;\n    var $videoPlayer;\n\n    console.log(videoProvider);\n\n    switch (videoProvider) {\n    case 'YOUTUBE':\n      videoCode = $('#vimeo-video-code').val();\n      $videoPlayer = $('#video-player');\n\n      if (!videoCode) return false;\n\n      $videoPlayer.html('<iframe width=\"100%\" height=\"600\" src=\"/api/v1/youtube?id=' + videoCode + '\"' +\n                    'frameborder=\"0\" allowfullscreen></iframe>');\n      break;\n\n    case 'VIMEO':\n      videoCode = $('#vimeo-video-code').val();\n      $videoPlayer = $('#video-player');\n\n      if (!videoCode) return false;\n\n      $videoPlayer.html('<iframe src=\"https://player.vimeo.com/video/' + videoCode + '\"?title=0&byline=0&portrait=0\" ' +\n          'width=\"100%\" height=\"600\" frameborder=\"0\" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>');\n      break;\n\n    case 'AQUA':\n      videoCode = $('#modify-video').data('video-id');\n      $aquaPlayerFrame.attr('src', '/api/v1/aqua?os=' + Util.getOSName() + '&video_id=' + videoCode);\n      break;\n\n    default:\n      break;\n    }\n  }\n\n  /**\n   * 윈도우 팝업창 종료 시 발생\n   *\n   */\n  window.onbeforeunload = function (event) {\n    if (_confirm) {\n      return confirm('진행중인 작업이 모두 사라집니다. 계속하시겠습니까?');\n    }\n  };\n});\n"],"sourceRoot":"/source/"}